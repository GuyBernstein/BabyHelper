<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BabyHelper Dashboard - Sleep Tracking</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700&family=Lora:wght@400;500;600&display=swap"
          rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Tailwind configuration with pastel theme
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pastel: {
                            lightest: '#fdf6f0',
                            light: '#ffe8d9',
                            primary: '#ff8c69',
                            primaryHover: '#ff7043',
                            secondary: '#ffd8cc',
                            accent1: '#ffb5a7',
                            accent2: '#fec89a',
                            text: '#6d5d52',
                            textLight: '#938278',
                            heading: '#5c4d44'
                        }
                    },
                    fontFamily: {
                        sans: ['Nunito Sans', 'sans-serif'],
                        serif: ['Lora', 'serif']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 2s infinite',
                        'fade-in-up': 'fadeInUp 1s ease-out forwards',
                        'fade-in-right': 'fadeInRight 1s ease-out forwards',
                        'fade-in-left': 'fadeInLeft 1s ease-out forwards',
                        'fade-in': 'fadeIn 1.2s ease-out forwards',
                        'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': {transform: 'translateY(0)'},
                            '50%': {transform: 'translateY(-20px)'},
                        },
                        fadeInUp: {
                            '0%': {opacity: '0', transform: 'translateY(20px)'},
                            '100%': {opacity: '1', transform: 'translateY(0)'},
                        },
                        fadeInRight: {
                            '0%': {opacity: '0', transform: 'translateX(-20px)'},
                            '100%': {opacity: '1', transform: 'translateX(0)'},
                        },
                        fadeInLeft: {
                            '0%': {opacity: '0', transform: 'translateX(20px)'},
                            '100%': {opacity: '1', transform: 'translateX(0)'},
                        },
                        fadeIn: {
                            '0%': {opacity: '0'},
                            '100%': {opacity: '1'},
                        },
                        pulseSoft: {
                            '0%, 100%': {opacity: '1'},
                            '50%': {opacity: '0.7'},
                        },
                    },
                    boxShadow: {
                        'pastel': '0 6px 12px rgba(180, 160, 150, 0.1)',
                        'pastel-lg': '0 10px 25px rgba(180, 160, 150, 0.15)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Blob animation styles */
        .blob-animation {
            animation: blob-move 15s infinite alternate;
        }

        @keyframes blob-move {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
            33% {
                transform: translate(30px, -50px) rotate(20deg) scale(1.1);
            }
            66% {
                transform: translate(-20px, 20px) rotate(-10deg) scale(0.9);
            }
            100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
        }

        /* Button hover effect */
        .btn-hover-effect:hover {
            box-shadow: 0 0 15px rgba(255, 140, 105, 0.5);
        }

        /* Custom scrollbar for pastel theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #fdf6f0;
        }

        ::-webkit-scrollbar-thumb {
            background: #ffb5a7;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #ff8c69;
        }

        /* Toggle switch styles */
        .toggle-switch {
            position: relative;
            width: 56px;
            height: 32px;
            background-color: #ffe8d9;
            border-radius: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .toggle-switch.active {
            background-color: #ff8c69;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 24px;
            height: 24px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-switch.active::after {
            transform: translateX(24px);
        }

        /* Star rating styles */
        .star-rating {
            display: flex;
            gap: 8px;
        }

        .star-rating button {
            width: 48px;
            height: 48px;
            padding: 0;
            border: none;
            background: none;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .star-rating button:hover {
            transform: scale(1.1);
        }

        .star-rating button svg {
            width: 100%;
            height: 100%;
            fill: #ffe8d9;
            stroke: #ffb5a7;
            stroke-width: 2;
            transition: fill 0.3s ease;
        }

        .star-rating button.filled svg {
            fill: #ff8c69;
            stroke: #ff8c69;
        }

        /* Sleep timer styles */
        .sleep-timer {
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.05em;
        }

        /* Loading spinner */
        .spinner {
            border: 2px solid #ffe8d9;
            border-top-color: #ff8c69;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="h-full bg-pastel-lightest font-sans text-pastel-text">
<div class="flex h-full relative">
    <!-- Background Decorative Elements -->
    <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 right-[10%] w-64 h-64 rounded-full bg-pastel-accent1 opacity-20 blur-3xl blob-animation"></div>
        <div class="absolute bottom-40 left-[15%] w-80 h-80 rounded-full bg-pastel-accent2 opacity-20 blur-3xl blob-animation"
             style="animation-delay: 2s;"></div>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn"
            class="lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-full shadow-pastel-lg opacity-0 animate-fade-in"
            style="animation-delay: 0.1s; animation-fill-mode: forwards;">
        <i data-lucide="menu" class="h-5 w-5 text-pastel-primary"></i>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar"
           class="fixed lg:relative inset-y-0 left-0 z-40 w-64 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col gap-6 border-r border-pastel-light bg-white/80 backdrop-blur-lg p-6">
        <!-- Logo and Brand -->
        <div class="flex items-center space-x-2 opacity-0 animate-fade-in-right"
             style="animation-delay: 0.2s; animation-fill-mode: forwards;">
            <div class="w-10 h-10 rounded-full bg-pastel-primary flex items-center justify-center text-white font-serif font-semibold text-xl">
                <i data-lucide="baby" class="h-6 w-6"></i>
            </div>
            <span class="font-serif text-pastel-heading text-xl">BabyHelper</span>
        </div>

        <!-- Quick Action Button -->
        <button class="btn-hover-effect flex items-center justify-between gap-3 text-sm font-medium bg-pastel-primary text-white p-3 rounded-full shadow-pastel transition-all duration-300 hover:bg-pastel-primaryHover hover:transform hover:-translate-y-0.5 opacity-0 animate-fade-in-right"
                style="animation-delay: 0.3s; animation-fill-mode: forwards;">
                <span class="flex items-center gap-3">
                    <i data-lucide="plus" class="h-4 w-4"></i>
                    Add New Entry
                </span>
            <kbd class="text-xs text-white/80 hidden sm:block">âŒ˜A</kbd>
        </button>

        <!-- Navigation -->
        <nav class="flex flex-col gap-2 text-sm opacity-0 animate-fade-in-right"
             style="animation-delay: 0.4s; animation-fill-mode: forwards;">
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full bg-pastel-light text-pastel-primary font-medium">
                <i data-lucide="bar-chart-3" class="h-4 w-4"></i>
                Insights & Analysis
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="moon" class="h-4 w-4"></i>
                Sleep Tracking
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="utensils" class="h-4 w-4"></i>
                <span class="flex-1">Feeding Log</span>
                <span class="ml-auto text-xs bg-pastel-accent1/20 text-pastel-primary px-2 py-0.5 rounded-full font-medium">NEW</span>
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="heart" class="h-4 w-4"></i>
                Health Records
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="calendar" class="h-4 w-4"></i>
                Development Milestones
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="settings" class="h-4 w-4"></i>
                Settings
            </a>
        </nav>

        <!-- Premium Upgrade Card -->
        <div class="mt-auto bg-gradient-to-br from-pastel-primary/10 to-pastel-accent1/10 p-4 rounded-2xl border border-pastel-light opacity-0 animate-fade-in-up"
             style="animation-delay: 0.5s; animation-fill-mode: forwards;">
            <p class="text-sm leading-relaxed text-pastel-text">
                Upgrade to <span class="font-semibold text-pastel-primary">BabyHelper Pro</span> for advanced insights
                and personalized recommendations!
            </p>
            <div class="flex items-center justify-between mt-4 text-sm">
                <button class="hover:underline text-pastel-textLight">Maybe Later</button>
                <button class="bg-pastel-primary hover:bg-pastel-primaryHover text-white px-4 py-1.5 rounded-full font-medium transition-colors">
                    Go Premium
                </button>
            </div>
        </div>
    </aside>

    <!-- Overlay for mobile -->
    <div id="overlay" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-30 lg:hidden hidden"></div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden relative z-10">
        <!-- Top bar -->
        <header class="flex items-center justify-between gap-4 px-4 lg:px-6 py-4 border-b border-pastel-light bg-white/60 backdrop-blur-lg opacity-0 animate-fade-in"
                style="animation-delay: 0.2s; animation-fill-mode: forwards;">
            <div class="flex items-center gap-4">
                <div class="lg:hidden w-8"></div>
                <div>
                    <h1 class="text-base lg:text-lg font-serif font-medium text-pastel-heading">Sleep Tracking</h1>
                    <p class="text-xs lg:text-sm text-pastel-textLight">
                        <span id="lastUpdateText">Loading...</span> â€¢
                        <span id="selectedBabyInfo">Loading baby data...</span>
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <!-- Baby Selector -->
                <select id="babySelector"
                        class="text-sm px-3 py-1.5 rounded-full border border-pastel-light bg-white focus:outline-none focus:ring-2 focus:ring-pastel-primary/30">
                    <option value="">Loading babies...</option>
                </select>
                <button class="relative hidden sm:block p-2 hover:bg-pastel-light rounded-full transition-colors">
                    <i data-lucide="bell" class="h-5 w-5 text-pastel-text"></i>
                    <span class="absolute top-1 right-1 h-2 w-2 rounded-full bg-pastel-primary"></span>
                </button>
                <button class="hidden sm:block p-2 hover:bg-pastel-light rounded-full transition-colors">
                    <i data-lucide="help-circle" class="h-5 w-5 text-pastel-text"></i>
                </button>
                <div class="h-9 w-9 rounded-full bg-gradient-to-br from-pastel-primary to-pastel-accent1 flex items-center justify-center text-sm font-medium text-white shadow-pastel">
                    <span id="userInitials">--</span>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <section class="flex-1 overflow-y-auto p-4 lg:p-6 space-y-6">
            <!-- Sleep Tracker Section -->
            <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                 style="animation-delay: 0.25s; animation-fill-mode: forwards;" id="sleepTrackerSection">
                <h2 class="text-xl font-serif font-medium text-pastel-heading mb-6 flex items-center gap-2">
                    <i data-lucide="moon" class="h-5 w-5 text-pastel-accent2"></i>
                    Sleep Tracker
                </h2>

                <!-- Sleep Status Display -->
                <div class="text-center mb-8">
                    <div id="sleepStatusBg"
                         class="inline-block p-8 rounded-full bg-pastel-light transition-colors duration-500">
                        <div class="text-4xl font-serif font-semibold text-pastel-heading mb-2" id="sleepStatus">Awake
                        </div>
                        <div class="text-2xl font-mono sleep-timer text-pastel-text" id="sleepDuration">00:00:00</div>
                    </div>
                </div>

                <!-- Start/Stop Controls -->
                <div class="flex justify-center mb-8">
                    <button id="sleepControlBtn"
                            class="w-[120px] h-[120px] rounded-full bg-pastel-primary hover:bg-pastel-primaryHover text-white shadow-pastel-lg transition-all duration-300 hover:transform hover:scale-105 btn-hover-effect flex items-center justify-center"
                            disabled>
                        <i data-lucide="moon" class="h-12 w-12" id="sleepControlIcon"></i>
                    </button>
                </div>

                <!-- Quick Location Selector -->
                <div class="mb-6">
                    <p class="text-sm text-pastel-textLight mb-3">Where is baby sleeping?</p>
                    <div class="flex flex-wrap gap-2 mb-3">
                        <button class="location-btn px-4 py-2 rounded-full border border-pastel-light bg-white hover:bg-pastel-light transition-colors text-sm"
                                data-location="crib">Crib
                        </button>
                        <button class="location-btn px-4 py-2 rounded-full border border-pastel-light bg-white hover:bg-pastel-light transition-colors text-sm"
                                data-location="bassinet">Bassinet
                        </button>
                        <button class="location-btn px-4 py-2 rounded-full border border-pastel-light bg-white hover:bg-pastel-light transition-colors text-sm"
                                data-location="car_seat">Car Seat
                        </button>
                        <button class="location-btn px-4 py-2 rounded-full border border-pastel-light bg-white hover:bg-pastel-light transition-colors text-sm"
                                data-location="stroller">Stroller
                        </button>
                        <button class="location-btn px-4 py-2 rounded-full border border-pastel-light bg-white hover:bg-pastel-light transition-colors text-sm"
                                data-location="parents_bed">Parents' Bed
                        </button>
                    </div>
                    <input type="text" placeholder="Other location..."
                           class="w-full px-4 py-2 rounded-full border border-pastel-light focus:outline-none focus:ring-2 focus:ring-pastel-primary/30 text-sm"
                           id="customLocationInput">
                </div>

                <!-- Environmental Factors -->
                <div class="mb-6">
                    <p class="text-sm text-pastel-textLight mb-3">Environmental factors</p>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                                <span class="flex items-center gap-2 text-sm">
                                    <i data-lucide="volume-2" class="h-4 w-4 text-pastel-textLight"></i>
                                    White Noise
                                </span>
                            <div class="toggle-switch" data-factor="white-noise"></div>
                        </div>
                        <div class="flex items-center justify-between">
                                <span class="flex items-center gap-2 text-sm">
                                    <i data-lucide="baby" class="h-4 w-4 text-pastel-textLight"></i>
                                    Pacifier
                                </span>
                            <div class="toggle-switch" data-factor="pacifier"></div>
                        </div>
                        <div class="flex items-center justify-between">
                                <span class="flex items-center gap-2 text-sm">
                                    <i data-lucide="package" class="h-4 w-4 text-pastel-textLight"></i>
                                    Swaddled
                                </span>
                            <div class="toggle-switch" data-factor="swaddled"></div>
                        </div>
                    </div>
                </div>

                <!-- Post-Sleep Section (Hidden by default) -->
                <div id="postSleepSection" class="hidden">
                    <!-- Sleep Quality Input -->
                    <div class="mb-6">
                        <p class="text-sm text-pastel-textLight mb-3">How was the sleep quality?</p>
                        <div class="star-rating" id="sleepQualityRating">
                            <button data-rating="1" title="Poor"><i data-lucide="star" class="h-12 w-12"></i></button>
                            <button data-rating="2" title="Fair"><i data-lucide="star" class="h-12 w-12"></i></button>
                            <button data-rating="3" title="Good"><i data-lucide="star" class="h-12 w-12"></i></button>
                            <button data-rating="4" title="Good"><i data-lucide="star" class="h-12 w-12"></i></button>
                            <button data-rating="5" title="Excellent"><i data-lucide="star" class="h-12 w-12"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Sleep Training Method -->
                    <div class="mb-6">
                        <p class="text-sm text-pastel-textLight mb-3">Sleep training method used?</p>
                        <select id="trainingMethodSelect"
                                class="w-full px-4 py-2 rounded-full border border-pastel-light focus:outline-none focus:ring-2 focus:ring-pastel-primary/30 text-sm">
                            <option value="none">None</option>
                            <option value="cry_it_out">Cry It Out</option>
                            <option value="ferber">Ferber Method</option>
                            <option value="chair">Chair Method</option>
                            <option value="pick_up_put_down">Pick Up Put Down</option>
                            <option value="bedtime_fading">Bedtime Fading</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <!-- Notes Section -->
                    <div class="mb-6">
                        <p class="text-sm text-pastel-textLight mb-3">Additional notes</p>
                        <textarea id="sleepNotes"
                                  placeholder="How did baby fall asleep? Any interruptions? Other observations..."
                                  rows="3"
                                  class="w-full px-4 py-3 rounded-2xl border border-pastel-light focus:outline-none focus:ring-2 focus:ring-pastel-primary/30 text-sm resize-none"></textarea>
                    </div>

                    <button id="saveSleepSession"
                            class="w-full bg-pastel-primary hover:bg-pastel-primaryHover text-white py-3 rounded-full font-medium transition-colors">
                        Save Sleep Session
                    </button>
                </div>

                <!-- Recent Sleep Patterns -->
                <div class="mt-8 pt-6 border-t border-pastel-light">
                    <p class="text-sm font-medium text-pastel-heading mb-4">Recent Sleep Sessions</p>
                    <div class="space-y-3" id="recentSleepList">
                        <div class="text-center text-pastel-textLight py-4">
                            <div class="spinner mx-auto mb-2"></div>
                            <p class="text-sm">Loading sleep history...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Insights Card -->
            <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                 style="animation-delay: 0.3s; animation-fill-mode: forwards;">
                <h2 class="text-xl font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                    <i data-lucide="lightbulb" class="h-5 w-5 text-pastel-accent2"></i>
                    Key Insights
                </h2>
                <div class="bg-pastel-lightest rounded-xl p-4 border border-pastel-light" id="keyInsightsContent">
                    <p class="text-pastel-text leading-relaxed">
                        <span class="text-pastel-textLight">Loading sleep insights...</span>
                    </p>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4" id="statsGrid">
                <!-- Stats will be dynamically populated -->
            </div>

            <!-- Behavioral Trends Section -->
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- Sleep Trends Chart -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-left"
                     style="animation-delay: 0.8s; animation-fill-mode: forwards;">
                    <h2 class="text-lg font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                        <i data-lucide="trending-up" class="h-5 w-5 text-pastel-accent2"></i>
                        Sleep Trends (7 Days)
                    </h2>
                    <div class="h-48 mb-4">
                        <canvas id="sleepChart"></canvas>
                    </div>
                    <p class="text-sm text-pastel-textLight" id="sleepChartDescription">
                        Loading sleep trend data...
                    </p>
                </div>

                <!-- Sleep Quality Chart -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-right"
                     style="animation-delay: 0.9s; animation-fill-mode: forwards;">
                    <h2 class="text-lg font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                        <i data-lucide="star" class="h-5 w-5 text-pastel-accent1"></i>
                        Sleep Quality Score
                    </h2>
                    <div class="h-48 mb-4" id="qualityScoreContainer">
                        <div class="text-center py-8">
                            <div class="spinner mx-auto mb-2"></div>
                            <p class="text-sm text-pastel-textLight">Analyzing sleep quality...</p>
                        </div>
                    </div>
                    <p class="text-sm text-pastel-textLight" id="qualityDescription">
                        Based on PSQI-inspired scoring methodology
                    </p>
                </div>
            </div>

            <!-- Personalized Recommendations -->
            <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                 style="animation-delay: 1.0s; animation-fill-mode: forwards;">
                <h2 class="text-xl font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                    <i data-lucide="sparkles" class="h-5 w-5 text-pastel-accent2"></i>
                    Personalized Recommendations
                </h2>
                <div class="grid gap-3" id="recommendationsContainer">
                    <div class="text-center text-pastel-textLight py-4">
                        <p class="text-sm">Analyzing sleep patterns for recommendations...</p>
                    </div>
                </div>
            </div>

            <!-- Decorative floating elements -->
            <div class="fixed bottom-20 right-10 w-32 h-32 rounded-full bg-pastel-accent1 opacity-10 animate-float pointer-events-none"></div>
            <div class="fixed top-40 right-1/4 w-24 h-24 rounded-full bg-pastel-accent2 opacity-10 animate-float-delayed pointer-events-none"></div>
        </section>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="lg:hidden border-t border-pastel-light bg-white/80 backdrop-blur-lg">
            <div class="grid grid-cols-4 gap-1">
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="home" class="h-5 w-5"></i>
                    <span class="text-xs">Home</span>
                </button>
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-primary">
                    <i data-lucide="moon" class="h-5 w-5"></i>
                    <span class="text-xs">Sleep</span>
                </button>
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="plus-circle" class="h-5 w-5"></i>
                    <span class="text-xs">Add</span>
                </button>
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="user" class="h-5 w-5"></i>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
        </nav>
    </div>
</div>

<script src="../js/auth.js" data-auto-init="true"></script>
<script>
    // Sleep Tracker Application State
    const SleepTracker = {
        currentBaby: null,
        selectedBabyId: null,
        sleepTimer: null,
        sleepStartTime: null,
        isSleeping: false,
        selectedLocation: null,
        sleepQuality: 0,
        environmentalFactors: {
            'white-noise': false,
            'pacifier': false,
            'swaddled': false
        },
        sleepChart: null,
        qualityChart: null
    };

    document.addEventListener('DOMContentLoaded', async () => {
        // Initialize Lucide icons
        lucide.createIcons();

        // Initialize the application
        await initializeSleepTracker();
    });

    // Initialize Sleep Tracker
    async function initializeSleepTracker() {
        try {
            // Load user profile first
            const userProfile = await BabyHelperAuth.api.endpoints.getUserProfile();
            updateUserDisplay(userProfile);

            // Load babies
            await loadBabies();

            // Setup event listeners
            setupEventListeners();

            // Enable sleep control after initialization
            document.getElementById('sleepControlBtn').disabled = false;
        } catch (error) {
            console.error('Failed to initialize sleep tracker:', error);
            showNotification('Failed to initialize app. Please refresh the page.', 'error');
        }
    }

    // Update user display
    function updateUserDisplay(userProfile) {
        const initials = userProfile.name
            .split(' ')
            .map(n => n[0])
            .join('')
            .toUpperCase()
            .slice(0, 2);
        document.getElementById('userInitials').textContent = initials;
    }

    // Load babies and populate selector
    async function loadBabies() {
        try {
            const babies = await BabyHelperAuth.api.endpoints.getBabies();
            const selector = document.getElementById('babySelector');

            selector.innerHTML = '<option value="">Select a baby</option>';

            babies.forEach(baby => {
                const option = document.createElement('option');
                option.value = baby.id;
                option.textContent = `${baby.fullname} (${calculateAgeInMonths(baby.birthdate)} months)`;
                selector.appendChild(option);
            });

            // Auto-select if only one baby
            if (babies.length === 1) {
                selector.value = babies[0].id;
                await selectBaby(babies[0].id);
            }
        } catch (error) {
            console.error('Failed to load babies:', error);
            showNotification('Failed to load babies', 'error');
        }
    }

    // Calculate baby's age in months
    function calculateAgeInMonths(birthdate) {
        const birth = new Date(birthdate);
        const now = new Date();
        const months = (now.getFullYear() - birth.getFullYear()) * 12 + (now.getMonth() - birth.getMonth());
        return Math.max(0, months);
    }

    // Select a baby and load their data
    async function selectBaby(babyId) {
        if (!babyId) return;

        SleepTracker.selectedBabyId = babyId;

        try {
            // Get baby info
            const babies = await BabyHelperAuth.api.endpoints.getBabies();
            SleepTracker.currentBaby = babies.find(b => b.id === parseInt(babyId));

            if (SleepTracker.currentBaby) {
                // Update display
                const ageInMonths = calculateAgeInMonths(SleepTracker.currentBaby.birthdate);
                document.getElementById('selectedBabyInfo').textContent =
                    `${SleepTracker.currentBaby.name}, ${ageInMonths} months`;

                // Load sleep data
                await loadRecentSleepSessions();
                await loadSleepPatterns();
                await loadSleepStats();
            }
        } catch (error) {
            console.error('Failed to select baby:', error);
            showNotification('Failed to load baby data', 'error');
        }
    }

    // Load recent sleep sessions
    async function loadRecentSleepSessions() {
        try {
            const response = await BabyHelperAuth.api.request(
                `/sleep/baby/${SleepTracker.selectedBabyId}?limit=5`
            );

            if (response.ok) {
                const sleepSessions = await response.json();
                displayRecentSleepSessions(sleepSessions);
            } else {
                throw new Error('Failed to load sleep sessions');
            }
        } catch (error) {
            console.error('Failed to load recent sleep sessions:', error);
            document.getElementById('recentSleepList').innerHTML =
                '<p class="text-sm text-pastel-textLight text-center py-4">No sleep data available</p>';
        }
    }

    // Display recent sleep sessions
    function displayRecentSleepSessions(sessions) {
        const container = document.getElementById('recentSleepList');

        if (sessions.length === 0) {
            container.innerHTML = '<p class="text-sm text-pastel-textLight text-center py-4">No sleep sessions recorded yet</p>';
            return;
        }

        container.innerHTML = sessions.map(session => {
            const startTime = new Date(session.start_time);
            const endTime = session.end_time ? new Date(session.end_time) : null;
            const duration = session.duration || 0;
            const quality = getQualityStars(session.quality);

            return `
                <div class="flex items-center justify-between p-3 rounded-xl bg-pastel-lightest hover:bg-pastel-light transition-colors cursor-pointer"
                     data-sleep-id="${session.id}">
                    <div class="flex items-center gap-3">
                        <i data-lucide="moon" class="h-4 w-4 text-pastel-textLight"></i>
                        <div>
                            <p class="text-sm font-medium">${formatSessionDate(startTime)}</p>
                            <p class="text-xs text-pastel-textLight">
                                Duration: ${formatDuration(duration)} â€¢
                                Quality: ${quality} â€¢
                                ${session.location ? formatLocation(session.location) : 'No location'}
                            </p>
                        </div>
                    </div>
                    <i data-lucide="chevron-right" class="h-4 w-4 text-pastel-textLight"></i>
                </div>
            `;
        }).join('');

        // Re-render icons
        lucide.createIcons();
    }

    // Format quality as stars
    function getQualityStars(quality) {
        const qualityMap = {
            'poor': 'â˜…â˜†â˜†â˜†â˜†',
            'fair': 'â˜…â˜…â˜†â˜†â˜†',
            'good': 'â˜…â˜…â˜…â˜†â˜†',
            'excellent': 'â˜…â˜…â˜…â˜…â˜…'
        };
        return qualityMap[quality] || '---';
    }

    // Format location enum
    function formatLocation(location) {
        const locationMap = {
            'crib': 'Crib',
            'bassinet': 'Bassinet',
            'parents_room': "Parents' Room",
            'parents_bed': "Parents' Bed",
            'car_seat': 'Car Seat',
            'stroller': 'Stroller',
            'other': 'Other'
        };
        return locationMap[location] || location;
    }

    // Format session date
    function formatSessionDate(date) {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);

        const sessionDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());

        if (sessionDate.getTime() === today.getTime()) {
            return `Today, ${date.toLocaleTimeString('en-US', {hour: 'numeric', minute: '2-digit', hour12: true})}`;
        } else if (sessionDate.getTime() === yesterday.getTime()) {
            return `Yesterday, ${date.toLocaleTimeString('en-US', {hour: 'numeric', minute: '2-digit', hour12: true})}`;
        } else {
            return date.toLocaleDateString('en-US', {month: 'short', day: 'numeric'}) + ', ' +
                date.toLocaleTimeString('en-US', {hour: 'numeric', minute: '2-digit', hour12: true});
        }
    }

    // Format duration in minutes to human readable
    function formatDuration(minutes) {
        if (!minutes) return '0m';

        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;

        if (hours > 0) {
            return `${hours}h ${mins}m`;
        }
        return `${mins}m`;
    }

    // Load sleep patterns and analysis
    async function loadSleepPatterns() {
        try {
            const response = await BabyHelperAuth.api.request(
                `/sleep/baby/${SleepTracker.selectedBabyId}/patterns?days=7&calculation_method=PSQI`
            );

            if (response.ok) {
                const patterns = await response.json();
                displaySleepPatterns(patterns);
                updateKeyInsights(patterns);
                updateRecommendations(patterns);
            }
        } catch (error) {
            console.error('Failed to load sleep patterns:', error);
        }
    }

    // Display sleep patterns in charts
    function displaySleepPatterns(patterns) {
        if (!patterns.patterns) return;

        const {summary, daily_sleep} = patterns.patterns;

        // Update sleep quality score display
        if (summary.sleep_quality_score !== undefined) {
            displayQualityScore(summary);
        }

        // Update sleep trends chart
        if (daily_sleep && daily_sleep.length > 0) {
            updateSleepTrendsChart(daily_sleep);
        }
    }

    // Display quality score
    function displayQualityScore(summary) {
        const container = document.getElementById('qualityScoreContainer');
        const scoreColor = getScoreColor(summary.sleep_quality_score);

        container.innerHTML = `
            <div class="text-center py-4">
                <div class="relative inline-block">
                    <svg class="w-32 h-32 transform -rotate-90">
                        <circle cx="64" cy="64" r="56" stroke="#ffe8d9" stroke-width="12" fill="none"></circle>
                        <circle cx="64" cy="64" r="56" stroke="${scoreColor}" stroke-width="12" fill="none"
                                stroke-dasharray="${summary.sleep_quality_score * 3.51} 351.86"
                                stroke-linecap="round"></circle>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div>
                            <div class="text-3xl font-serif font-bold text-pastel-heading">${Math.round(summary.sleep_quality_score)}</div>
                            <div class="text-sm text-pastel-textLight">${summary.sleep_quality_rating}</div>
                        </div>
                    </div>
                </div>
                <p class="text-xs text-pastel-textLight mt-4">${summary.sleep_quality_explanation}</p>
            </div>
        `;
    }

    // Get color based on score
    function getScoreColor(score) {
        if (score >= 85) return '#22c55e'; // Excellent - green
        if (score >= 70) return '#ff8c69'; // Good - primary color
        if (score >= 50) return '#fec89a'; // Fair - accent2
        return '#ef4444'; // Poor - red
    }

    // Update sleep trends chart
    function updateSleepTrendsChart(dailySleep) {
        const ctx = document.getElementById('sleepChart').getContext('2d');

        // Destroy existing chart if it exists
        if (SleepTracker.sleepChart) {
            SleepTracker.sleepChart.destroy();
        }

        const labels = dailySleep.map(d => {
            const date = new Date(d.date);
            return date.toLocaleDateString('en-US', {weekday: 'short'});
        });

        const totalSleepData = dailySleep.map(d => d.total_hours);
        const nightSleepData = dailySleep.map(d => (d.night_minutes / 60).toFixed(2));
        const napData = dailySleep.map(d => (d.nap_minutes / 60).toFixed(2));

        SleepTracker.sleepChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Total Sleep',
                    data: totalSleepData,
                    borderColor: '#ff8c69',
                    backgroundColor: 'rgba(255, 140, 105, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#ff8c69',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: 'Night Sleep',
                    data: nightSleepData,
                    borderColor: '#ffb5a7',
                    backgroundColor: 'rgba(255, 181, 167, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#ffb5a7',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: 'Naps',
                    data: napData,
                    borderColor: '#fec89a',
                    backgroundColor: 'rgba(254, 200, 154, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#fec89a',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 15,
                            font: {
                                family: "'Nunito Sans', sans-serif",
                                size: 12
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function (value) {
                                return value + 'h';
                            }
                        },
                        grid: {
                            color: '#ffe8d9'
                        }
                    },
                    x: {
                        grid: {
                            color: '#ffe8d9'
                        }
                    }
                }
            }
        });

        // Update description
        const avgSleep = (totalSleepData.reduce((a, b) => a + parseFloat(b), 0) / totalSleepData.length).toFixed(1);
        document.getElementById('sleepChartDescription').textContent =
            `Average sleep: ${avgSleep} hours per day over the last ${dailySleep.length} days`;
    }

    // Update key insights
    function updateKeyInsights(patterns) {
        const insights = document.getElementById('keyInsightsContent');
        const {summary} = patterns.patterns;

        if (!summary) return;

        const babyName = SleepTracker.currentBaby?.name || 'Your baby';
        const avgHours = summary.avg_total_sleep_hours.toFixed(1);
        const trend = summary.avg_total_sleep_hours >= 8 ? 'wonderful' : 'improving';

        insights.innerHTML = `
            <p class="text-pastel-text leading-relaxed">
                ${babyName} has averaged
                <span class="font-semibold text-pastel-primary">${avgHours} hours of sleep</span>
                per day over the last week.
                <span class="text-pastel-accent1 font-medium">That's ${trend}! ðŸŒ™</span>
                ${summary.avg_naps_per_day > 0 ?
            `<br><span class="text-sm">Average of ${summary.avg_naps_per_day.toFixed(1)} naps per day.</span>`
            : ''}
            </p>
        `;
    }

    // Load sleep statistics
    async function loadSleepStats() {
        try {
            const response = await BabyHelperAuth.api.request(
                `/sleep/baby/${SleepTracker.selectedBabyId}/patterns?days=7`
            );

            if (response.ok) {
                const data = await response.json();
                updateStatsGrid(data.patterns.summary);
            }
        } catch (error) {
            console.error('Failed to load sleep stats:', error);
        }
    }

    // Update stats grid
    function updateStatsGrid(summary) {
        const grid = document.getElementById('statsGrid');

        const stats = [
            {
                title: 'Avg Sleep/Night',
                value: `${summary.avg_night_sleep_hours.toFixed(1)} hrs`,
                subtitle: summary.avg_night_sleep_hours >= 8 ? 'â†‘ Great sleep!' : 'Room to improve',
                icon: 'moon',
                color: 'secondary'
            },
            {
                title: 'Daily Naps',
                value: summary.avg_naps_per_day.toFixed(1),
                subtitle: 'Average per day',
                icon: 'sun',
                color: 'accent1'
            },
            {
                title: 'Sleep Quality',
                value: summary.sleep_quality_rating || 'N/A',
                subtitle: summary.sleep_quality_score ? `Score: ${Math.round(summary.sleep_quality_score)}` : 'No data',
                icon: 'star',
                color: 'accent2'
            },
            {
                title: 'Total Sleep',
                value: `${summary.avg_total_sleep_hours.toFixed(1)} hrs`,
                subtitle: 'Daily average',
                icon: 'clock',
                color: 'primary'
            }
        ];

        grid.innerHTML = stats.map((stat, index) => `
            <div class="bg-white rounded-xl shadow-pastel border border-pastel-light p-4 opacity-0 animate-fade-in-up"
                 style="animation-delay: ${0.4 + (index * 0.1)}s; animation-fill-mode: forwards;">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs text-pastel-textLight">${stat.title}</p>
                        <p class="text-2xl font-semibold text-pastel-heading font-serif">${stat.value}</p>
                        <p class="text-xs text-pastel-${stat.color === 'primary' ? 'primary' : 'textLight'} mt-1">${stat.subtitle}</p>
                    </div>
                    <div class="h-10 w-10 bg-pastel-${stat.color}/20 rounded-full flex items-center justify-center">
                        <i data-lucide="${stat.icon}" class="h-5 w-5 text-pastel-${stat.color === 'secondary' ? 'primary' : stat.color}"></i>
                    </div>
                </div>
            </div>
        `).join('');

        // Re-render icons
        lucide.createIcons();
    }

    // Update recommendations
    function updateRecommendations(patterns) {
        const container = document.getElementById('recommendationsContainer');
        const {summary} = patterns.patterns;

        const recommendations = [];

        // Generate recommendations based on sleep data
        if (summary.avg_total_sleep_hours < 10) {
            recommendations.push({
                icon: 'clock',
                color: 'primary',
                text: 'Consider an earlier bedtime to increase total sleep hours.'
            });
        }

        if (summary.avg_naps_per_day > 3) {
            recommendations.push({
                icon: 'sun',
                color: 'accent2',
                text: 'Try consolidating daytime naps for better nighttime sleep.'
            });
        }

        if (summary.sleep_quality_score && summary.sleep_quality_score < 70) {
            recommendations.push({
                icon: 'moon',
                color: 'accent1',
                text: 'Focus on sleep environment: ensure room is dark, quiet, and cool.'
            });
        }

        // Always add a positive recommendation
        recommendations.push({
            icon: 'check-circle',
            color: 'primary',
            text: 'Keep tracking sleep patterns to identify what works best for your baby.'
        });

        container.innerHTML = recommendations.map(rec => `
            <div class="bg-pastel-lightest rounded-xl p-4 border border-pastel-light flex items-start gap-3 hover:shadow-pastel transition-shadow">
                <i data-lucide="${rec.icon}" class="h-5 w-5 text-pastel-${rec.color} mt-0.5"></i>
                <p class="text-pastel-text">${rec.text}</p>
            </div>
        `).join('');

        // Re-render icons
        lucide.createIcons();
    }

    // Setup event listeners
    function setupEventListeners() {
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        function toggleMobileMenu() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        overlay.addEventListener('click', toggleMobileMenu);

        // Baby selector
        document.getElementById('babySelector').addEventListener('change', (e) => {
            selectBaby(e.target.value);
        });

        // Sleep control button
        document.getElementById('sleepControlBtn').addEventListener('click', toggleSleep);

        // Location buttons
        const locationBtns = document.querySelectorAll('.location-btn');
        const customLocationInput = document.getElementById('customLocationInput');

        locationBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active state from all buttons
                locationBtns.forEach(b => {
                    b.classList.remove('bg-pastel-primary', 'text-white');
                    b.classList.add('bg-white', 'text-pastel-text');
                });

                // Set active state
                btn.classList.remove('bg-white', 'text-pastel-text');
                btn.classList.add('bg-pastel-primary', 'text-white');
                SleepTracker.selectedLocation = btn.dataset.location;
                customLocationInput.value = '';
            });
        });

        customLocationInput.addEventListener('input', () => {
            if (customLocationInput.value) {
                // Remove active state from all buttons
                locationBtns.forEach(b => {
                    b.classList.remove('bg-pastel-primary', 'text-white');
                    b.classList.add('bg-white', 'text-pastel-text');
                });
                SleepTracker.selectedLocation = 'other';
            }
        });

        // Environmental factors
        const toggleSwitches = document.querySelectorAll('.toggle-switch');
        toggleSwitches.forEach(toggle => {
            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
                const factor = toggle.dataset.factor;
                SleepTracker.environmentalFactors[factor] = toggle.classList.contains('active');
            });
        });

        // Sleep quality rating
        const starButtons = document.querySelectorAll('#sleepQualityRating button');
        starButtons.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                SleepTracker.sleepQuality = parseInt(btn.dataset.rating);

                // Update star display
                starButtons.forEach((star, starIndex) => {
                    if (starIndex < SleepTracker.sleepQuality) {
                        star.classList.add('filled');
                    } else {
                        star.classList.remove('filled');
                    }
                });

                // Re-render icons
                lucide.createIcons();
            });
        });

        // Save sleep session
        document.getElementById('saveSleepSession').addEventListener('click', saveSleepSession);

        // Update last update time
        updateLastUpdateTime();
        setInterval(updateLastUpdateTime, 60000); // Update every minute
    }

    // Toggle sleep state
    function toggleSleep() {
        if (!SleepTracker.selectedBabyId) {
            showNotification('Please select a baby first', 'warning');
            return;
        }

        SleepTracker.isSleeping = !SleepTracker.isSleeping;

        const sleepStatus = document.getElementById('sleepStatus');
        const sleepStatusBg = document.getElementById('sleepStatusBg');
        const sleepControlIcon = document.getElementById('sleepControlIcon');
        const postSleepSection = document.getElementById('postSleepSection');

        if (SleepTracker.isSleeping) {
            // Start sleep
            SleepTracker.sleepStartTime = new Date();
            sleepStatus.textContent = 'Sleeping';
            sleepStatusBg.classList.add('bg-pastel-primary/20', 'animate-pulse-soft');
            sleepStatusBg.classList.remove('bg-pastel-light');
            sleepControlIcon.setAttribute('data-lucide', 'sun');
            postSleepSection.classList.add('hidden');

            // Start timer
            SleepTracker.sleepTimer = setInterval(updateSleepTimer, 1000);

            // Provide haptic feedback if available
            if ('vibrate' in navigator) {
                navigator.vibrate(100);
            }
        } else {
            // End sleep
            clearInterval(SleepTracker.sleepTimer);
            sleepStatus.textContent = 'Awake';
            sleepStatusBg.classList.remove('bg-pastel-primary/20', 'animate-pulse-soft');
            sleepStatusBg.classList.add('bg-pastel-light');
            sleepControlIcon.setAttribute('data-lucide', 'moon');
            postSleepSection.classList.remove('hidden');

            // Provide haptic feedback if available
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            }
        }

        // Re-render the icon
        lucide.createIcons();
    }

    // Update sleep timer display
    function updateSleepTimer() {
        if (!SleepTracker.sleepStartTime) return;

        const now = new Date();
        const elapsed = Math.floor((now - SleepTracker.sleepStartTime) / 1000);
        const hours = Math.floor(elapsed / 3600);
        const minutes = Math.floor((elapsed % 3600) / 60);
        const seconds = elapsed % 60;

        document.getElementById('sleepDuration').textContent =
            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Save sleep session
    async function saveSleepSession() {
        if (!SleepTracker.sleepStartTime || !SleepTracker.selectedBabyId) {
            showNotification('Invalid sleep session', 'error');
            return;
        }

        // Gather environmental factors from notes
        const notes = document.getElementById('sleepNotes').value;
        const environmentalNotes = [];

        if (SleepTracker.environmentalFactors['white-noise']) environmentalNotes.push('White noise');
        if (SleepTracker.environmentalFactors['pacifier']) environmentalNotes.push('Pacifier used');
        if (SleepTracker.environmentalFactors['swaddled']) environmentalNotes.push('Swaddled');

        const fullNotes = environmentalNotes.length > 0
            ? `${environmentalNotes.join(', ')}. ${notes}`.trim()
            : notes;

        // Map star rating to quality enum
        const qualityMap = {
            1: 'poor',
            2: 'fair',
            3: 'good',
            4: 'good',
            5: 'excellent'
        };

        const sleepData = {
            baby_id: parseInt(SleepTracker.selectedBabyId),
            start_time: SleepTracker.sleepStartTime.toISOString(),
            end_time: new Date().toISOString(),
            quality: qualityMap[SleepTracker.sleepQuality] || null,
            location: SleepTracker.selectedLocation || null,
            training_method: document.getElementById('trainingMethodSelect').value || 'none',
            notes: fullNotes || null
        };

        try {
            const response = await BabyHelperAuth.api.request('/sleep/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(sleepData)
            });

            if (response.ok) {
                showNotification('Sleep session saved successfully!', 'success');
                resetSleepForm();
                // Reload data
                await loadRecentSleepSessions();
                await loadSleepPatterns();
                await loadSleepStats();
            } else {
                const error = await BabyHelperAuth.api.parseErrorResponse(response);
                throw new Error(error.message || 'Failed to save sleep session');
            }
        } catch (error) {
            console.error('Failed to save sleep session:', error);
            showNotification('Failed to save sleep session', 'error');
        }
    }

    // Reset sleep form
    function resetSleepForm() {
        // Reset timer
        document.getElementById('sleepDuration').textContent = '00:00:00';
        SleepTracker.sleepStartTime = null;
        SleepTracker.selectedLocation = null;
        SleepTracker.sleepQuality = 0;

        // Reset UI elements
        document.querySelectorAll('.location-btn').forEach(btn => {
            btn.classList.remove('bg-pastel-primary', 'text-white');
            btn.classList.add('bg-white', 'text-pastel-text');
        });

        document.getElementById('customLocationInput').value = '';

        document.querySelectorAll('.toggle-switch').forEach(toggle => {
            toggle.classList.remove('active');
        });

        Object.keys(SleepTracker.environmentalFactors).forEach(key => {
            SleepTracker.environmentalFactors[key] = false;
        });

        document.querySelectorAll('#sleepQualityRating button').forEach(btn => {
            btn.classList.remove('filled');
        });

        document.getElementById('trainingMethodSelect').value = 'none';
        document.getElementById('sleepNotes').value = '';
        document.getElementById('postSleepSection').classList.add('hidden');
    }

    // Update last update time
    function updateLastUpdateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
        });
        document.getElementById('lastUpdateText').textContent = `Last updated: ${timeString}`;
    }

    // Show notification
    function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-xl shadow-pastel-lg animate-fade-in-right`;

        // Set color based on type
        const colorClasses = {
            success: 'bg-green-100 text-green-800 border border-green-200',
            error: 'bg-red-100 text-red-800 border border-red-200',
            warning: 'bg-yellow-100 text-yellow-800 border border-yellow-200',
            info: 'bg-pastel-light text-pastel-text border border-pastel-secondary'
        };

        notification.className += ` ${colorClasses[type] || colorClasses.info}`;
        notification.innerHTML = `
            <div class="flex items-center gap-2">
                <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info'}"
                   class="h-5 w-5"></i>
                <span class="text-sm font-medium">${message}</span>
            </div>
        `;

        document.body.appendChild(notification);
        lucide.createIcons();

        // Remove after 3 seconds
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // Add keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        // Cmd/Ctrl + S to toggle sleep
        if ((e.metaKey || e.ctrlKey) && e.key === 's') {
            e.preventDefault();
            if (!document.getElementById('sleepControlBtn').disabled) {
                toggleSleep();
            }
        }
    });
</script>
</body>
</html>