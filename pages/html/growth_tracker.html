<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BabyHelper Dashboard - Insights & Analysis</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700&family=Lora:wght@400;500;600&display=swap"
          rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Tailwind configuration with pastel theme
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pastel: {
                            lightest: '#fdf6f0',
                            light: '#ffe8d9',
                            primary: '#ff8c69',
                            primaryHover: '#ff7043',
                            secondary: '#ffd8cc',
                            accent1: '#ffb5a7',
                            accent2: '#fec89a',
                            text: '#6d5d52',
                            textLight: '#938278',
                            heading: '#5c4d44',
                            success: '#8CC984',
                            warning: '#F4A460',
                            danger: '#FF6B6B'
                        }
                    },
                    fontFamily: {
                        sans: ['Nunito Sans', 'sans-serif'],
                        serif: ['Lora', 'serif']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 2s infinite',
                        'fade-in-up': 'fadeInUp 1s ease-out forwards',
                        'fade-in-right': 'fadeInRight 1s ease-out forwards',
                        'fade-in-left': 'fadeInLeft 1s ease-out forwards',
                        'fade-in': 'fadeIn 1.2s ease-out forwards',
                        'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': {transform: 'translateY(0)'},
                            '50%': {transform: 'translateY(-20px)'},
                        },
                        fadeInUp: {
                            '0%': {opacity: '0', transform: 'translateY(20px)'},
                            '100%': {opacity: '1', transform: 'translateY(0)'},
                        },
                        fadeInRight: {
                            '0%': {opacity: '0', transform: 'translateX(-20px)'},
                            '100%': {opacity: '1', transform: 'translateX(0)'},
                        },
                        fadeInLeft: {
                            '0%': {opacity: '0', transform: 'translateX(20px)'},
                            '100%': {opacity: '1', transform: 'translateX(0)'},
                        },
                        fadeIn: {
                            '0%': {opacity: '0'},
                            '100%': {opacity: '1'},
                        },
                        pulseSoft: {
                            '0%, 100%': {transform: 'scale(1)', opacity: '0.7'},
                            '50%': {transform: 'scale(1.05)', opacity: '1'},
                        },
                    },
                    boxShadow: {
                        'pastel': '0 6px 12px rgba(180, 160, 150, 0.1)',
                        'pastel-lg': '0 10px 25px rgba(180, 160, 150, 0.15)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Blob animation styles */
        .blob-animation {
            animation: blob-move 15s infinite alternate;
        }

        @keyframes blob-move {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
            33% {
                transform: translate(30px, -50px) rotate(20deg) scale(1.1);
            }
            66% {
                transform: translate(-20px, 20px) rotate(-10deg) scale(0.9);
            }
            100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
        }

        /* Button hover effect */
        .btn-hover-effect:hover {
            box-shadow: 0 0 15px rgba(255, 140, 105, 0.5);
        }

        /* Custom scrollbar for pastel theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #fdf6f0;
        }

        ::-webkit-scrollbar-thumb {
            background: #ffb5a7;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #ff8c69;
        }

        /* Number input styling */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        /* Slider styling */
        .custom-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #ffe8d9;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            border-radius: 4px;
        }

        .custom-slider:hover {
            opacity: 1;
        }

        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ff8c69;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .custom-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #ff8c69;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Percentile indicator animation */
        .percentile-indicator {
            transition: all 0.3s ease-in-out;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #ffe8d9;
            border-top: 3px solid #ff8c69;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.show {
            display: flex;
        }
    </style>
</head>
<body class="h-full bg-pastel-lightest font-sans text-pastel-text">
<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
</div>

<!-- Baby Selector Modal -->
<div id="babySelectorModal"
     class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-pastel-lg p-6 max-w-md w-full">
        <h2 class="text-xl font-serif font-medium text-pastel-heading mb-4">Select Baby</h2>
        <div id="babyList" class="space-y-2 mb-4">
            <!-- Baby options will be populated here -->
        </div>
        <button onclick="closeBabySelector()"
                class="w-full bg-pastel-light hover:bg-pastel-secondary text-pastel-text py-2 rounded-full transition-colors">
            Cancel
        </button>
    </div>
</div>

<!-- New Measurement Modal -->
<div id="measurementModal"
     class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-pastel-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
        <h2 class="text-xl font-serif font-medium text-pastel-heading mb-4">New Measurement</h2>
        <form id="measurementForm" class="space-y-4">
            <div>
                <label class="block text-sm text-pastel-textLight mb-2">Measurement Date</label>
                <input type="datetime-local" id="measurementDate" required
                       class="w-full px-4 py-2 bg-pastel-lightest rounded-xl focus:outline-none focus:ring-2 focus:ring-pastel-primary">
            </div>
            <div>
                <label class="block text-sm text-pastel-textLight mb-2">Weight (<span
                        class="weight-unit">kg</span>)</label>
                <input type="number" id="measurementWeight" step="0.01" min="0" max="50"
                       class="w-full px-4 py-2 bg-pastel-lightest rounded-xl focus:outline-none focus:ring-2 focus:ring-pastel-primary">
            </div>
            <div>
                <label class="block text-sm text-pastel-textLight mb-2">Height (<span
                        class="height-unit">cm</span>)</label>
                <input type="number" id="measurementHeight" step="0.1" min="0" max="200"
                       class="w-full px-4 py-2 bg-pastel-lightest rounded-xl focus:outline-none focus:ring-2 focus:ring-pastel-primary">
            </div>
            <div>
                <label class="block text-sm text-pastel-textLight mb-2">Head Circumference (<span
                        class="height-unit">cm</span>)</label>
                <input type="number" id="measurementHead" step="0.1" min="0" max="100"
                       class="w-full px-4 py-2 bg-pastel-lightest rounded-xl focus:outline-none focus:ring-2 focus:ring-pastel-primary">
            </div>
            <div>
                <label class="block text-sm text-pastel-textLight mb-2">Notes</label>
                <textarea id="measurementNotes" rows="3"
                          class="w-full px-4 py-2 bg-pastel-lightest rounded-xl focus:outline-none focus:ring-2 focus:ring-pastel-primary"></textarea>
            </div>
            <div class="flex gap-2">
                <button type="submit"
                        class="flex-1 bg-pastel-primary hover:bg-pastel-primaryHover text-white py-2 rounded-full transition-colors">
                    Save Measurement
                </button>
                <button type="button" onclick="closeMeasurementModal()"
                        class="flex-1 bg-pastel-light hover:bg-pastel-secondary text-pastel-text py-2 rounded-full transition-colors">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<div class="flex h-full relative">
    <!-- Background Decorative Elements -->
    <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 right-[10%] w-64 h-64 rounded-full bg-pastel-accent1 opacity-20 blur-3xl blob-animation"></div>
        <div class="absolute bottom-40 left-[15%] w-80 h-80 rounded-full bg-pastel-accent2 opacity-20 blur-3xl blob-animation"
             style="animation-delay: 2s;"></div>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn"
            class="lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-full shadow-pastel-lg opacity-0 animate-fade-in"
            style="animation-delay: 0.1s; animation-fill-mode: forwards;">
        <i data-lucide="menu" class="h-5 w-5 text-pastel-primary"></i>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar"
           class="fixed lg:relative inset-y-0 left-0 z-40 w-64 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col gap-6 border-r border-pastel-light bg-white/80 backdrop-blur-lg p-6">
        <!-- Logo and Brand -->
        <div class="flex items-center space-x-2 opacity-0 animate-fade-in-right"
             style="animation-delay: 0.2s; animation-fill-mode: forwards;">
            <div class="w-10 h-10 rounded-full bg-pastel-primary flex items-center justify-center text-white font-serif font-semibold text-xl">
                <i data-lucide="baby" class="h-6 w-6"></i>
            </div>
            <span class="font-serif text-pastel-heading text-xl">BabyHelper</span>
        </div>

        <!-- Quick Action Button -->
        <button onclick="openMeasurementModal()"
                class="btn-hover-effect flex items-center justify-between gap-3 text-sm font-medium bg-pastel-primary text-white p-3 rounded-full shadow-pastel transition-all duration-300 hover:bg-pastel-primaryHover hover:transform hover:-translate-y-0.5 opacity-0 animate-fade-in-right"
                style="animation-delay: 0.3s; animation-fill-mode: forwards;">
                <span class="flex items-center gap-3">
                    <i data-lucide="plus" class="h-4 w-4"></i>
                    Add New Entry
                </span>
            <kbd class="text-xs text-white/80 hidden sm:block">‚åòA</kbd>
        </button>

        <!-- Navigation -->
        <nav class="flex flex-col gap-2 text-sm opacity-0 animate-fade-in-right"
             style="animation-delay: 0.4s; animation-fill-mode: forwards;">
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full bg-pastel-light text-pastel-primary font-medium">
                <i data-lucide="bar-chart-3" class="h-4 w-4"></i>
                Insights & Analysis
            </a>
            <a href="#growth-measurements"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="ruler" class="h-4 w-4"></i>
                <span class="flex-1">Growth Tracking</span>
                <span class="ml-auto text-xs bg-pastel-success/20 text-pastel-success px-2 py-0.5 rounded-full font-medium">NEW</span>
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="moon" class="h-4 w-4"></i>
                Sleep Tracking
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="utensils" class="h-4 w-4"></i>
                <span class="flex-1">Feeding Log</span>
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="heart" class="h-4 w-4"></i>
                Health Records
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="calendar" class="h-4 w-4"></i>
                Development Milestones
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="settings" class="h-4 w-4"></i>
                Settings
            </a>
        </nav>

        <!-- Premium Upgrade Card -->
        <div class="mt-auto bg-gradient-to-br from-pastel-primary/10 to-pastel-accent1/10 p-4 rounded-2xl border border-pastel-light opacity-0 animate-fade-in-up"
             style="animation-delay: 0.5s; animation-fill-mode: forwards;">
            <p class="text-sm leading-relaxed text-pastel-text">
                Upgrade to <span class="font-semibold text-pastel-primary">BabyHelper Pro</span> for advanced insights
                and personalized recommendations!
            </p>
            <div class="flex items-center justify-between mt-4 text-sm">
                <button class="hover:underline text-pastel-textLight">Maybe Later</button>
                <button class="bg-pastel-primary hover:bg-pastel-primaryHover text-white px-4 py-1.5 rounded-full font-medium transition-colors">
                    Go Premium
                </button>
            </div>
        </div>
    </aside>

    <!-- Overlay for mobile -->
    <div id="overlay" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-30 lg:hidden hidden"></div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden relative z-10">
        <!-- Top bar -->
        <header class="flex items-center justify-between gap-4 px-4 lg:px-6 py-4 border-b border-pastel-light bg-white/60 backdrop-blur-lg opacity-0 animate-fade-in"
                style="animation-delay: 0.2s; animation-fill-mode: forwards;">
            <div class="flex items-center gap-4">
                <div class="lg:hidden w-8"></div>
                <div>
                    <h1 class="text-base lg:text-lg font-serif font-medium text-pastel-heading">Dashboard &
                        Insights</h1>
                    <p class="text-xs lg:text-sm text-pastel-textLight">
                        Last updated: <span id="lastUpdated">Loading...</span> ‚Ä¢
                        <span id="babyInfo" class="cursor-pointer hover:text-pastel-primary">
                            <span id="babyName">Loading...</span>, <span id="babyAge">...</span>
                        </span>
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button class="relative hidden sm:block p-2 hover:bg-pastel-light rounded-full transition-colors">
                    <i data-lucide="bell" class="h-5 w-5 text-pastel-text"></i>
                    <span class="absolute top-1 right-1 h-2 w-2 rounded-full bg-pastel-primary"></span>
                </button>
                <button class="hidden sm:block p-2 hover:bg-pastel-light rounded-full transition-colors">
                    <i data-lucide="help-circle" class="h-5 w-5 text-pastel-text"></i>
                </button>
                <div id="userAvatar"
                     class="h-9 w-9 rounded-full bg-gradient-to-br from-pastel-primary to-pastel-accent1 flex items-center justify-center text-sm font-medium text-white shadow-pastel">
                    ?
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <section class="flex-1 overflow-y-auto p-4 lg:p-6 space-y-6">
            <!-- Key Insights Card -->
            <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                 style="animation-delay: 0.3s; animation-fill-mode: forwards;">
                <h2 class="text-xl font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                    <i data-lucide="lightbulb" class="h-5 w-5 text-pastel-accent2"></i>
                    Key Insights
                </h2>
                <div class="bg-pastel-lightest rounded-xl p-4 border border-pastel-light">
                    <p class="text-pastel-text leading-relaxed" id="keyInsights">
                        Loading growth insights...
                    </p>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl shadow-pastel border border-pastel-light p-4 opacity-0 animate-fade-in-up"
                     style="animation-delay: 0.4s; animation-fill-mode: forwards;">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs text-pastel-textLight">Current Weight</p>
                            <p class="text-2xl font-semibold text-pastel-heading font-serif">
                                <span id="currentWeightValue">--</span> <span class="text-sm weight-unit">kg</span>
                            </p>
                            <p class="text-xs mt-1" id="weightChange">--</p>
                        </div>
                        <div class="h-10 w-10 bg-pastel-secondary rounded-full flex items-center justify-center">
                            <i data-lucide="weight" class="h-5 w-5 text-pastel-primary"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-pastel border border-pastel-light p-4 opacity-0 animate-fade-in-up"
                     style="animation-delay: 0.5s; animation-fill-mode: forwards;">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs text-pastel-textLight">Current Height</p>
                            <p class="text-2xl font-semibold text-pastel-heading font-serif">
                                <span id="currentHeightValue">--</span> <span class="text-sm height-unit">cm</span>
                            </p>
                            <p class="text-xs mt-1" id="heightChange">--</p>
                        </div>
                        <div class="h-10 w-10 bg-pastel-accent1/20 rounded-full flex items-center justify-center">
                            <i data-lucide="ruler" class="h-5 w-5 text-pastel-accent1"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-pastel border border-pastel-light p-4 opacity-0 animate-fade-in-up"
                     style="animation-delay: 0.6s; animation-fill-mode: forwards;">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs text-pastel-textLight">Head Circumference</p>
                            <p class="text-2xl font-semibold text-pastel-heading font-serif">
                                <span id="currentHeadValue">--</span> <span class="text-sm height-unit">cm</span>
                            </p>
                            <p class="text-xs mt-1" id="headChange">--</p>
                        </div>
                        <div class="h-10 w-10 bg-pastel-accent2/20 rounded-full flex items-center justify-center">
                            <i data-lucide="circle" class="h-5 w-5 text-pastel-accent2"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-pastel border border-pastel-light p-4 opacity-0 animate-fade-in-up"
                     style="animation-delay: 0.7s; animation-fill-mode: forwards;">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs text-pastel-textLight">Measurements</p>
                            <p class="text-2xl font-semibold text-pastel-heading font-serif" id="totalMeasurements">
                                --</p>
                            <p class="text-xs text-pastel-primary mt-1">Total recorded</p>
                        </div>
                        <div class="h-10 w-10 bg-pastel-primary/20 rounded-full flex items-center justify-center">
                            <i data-lucide="clipboard-list" class="h-5 w-5 text-pastel-primary"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Growth Measurements Section -->
            <div id="growth-measurements" class="space-y-6">
                <!-- Measurement Input Interface -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                     style="animation-delay: 0.8s; animation-fill-mode: forwards;">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-serif font-medium text-pastel-heading flex items-center gap-2">
                            <i data-lucide="ruler" class="h-5 w-5 text-pastel-accent2"></i>
                            Growth Measurements
                        </h2>
                        <!-- Unit Selector -->
                        <div class="flex bg-pastel-light rounded-full p-1">
                            <button id="metricBtn"
                                    class="px-4 py-2 rounded-full text-sm font-medium bg-white text-pastel-primary shadow-pastel transition-all">
                                Metric
                            </button>
                            <button id="imperialBtn"
                                    class="px-4 py-2 rounded-full text-sm font-medium text-pastel-text transition-all">
                                Imperial
                            </button>
                        </div>
                    </div>

                    <!-- Quick Action Buttons -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        <button onclick="openMeasurementModal('weight')"
                                class="btn-hover-effect bg-pastel-primary text-white p-4 rounded-2xl shadow-pastel transition-all duration-300 hover:bg-pastel-primaryHover hover:transform hover:-translate-y-0.5">
                            <i data-lucide="weight" class="h-6 w-6 mb-2 mx-auto"></i>
                            <span class="block text-sm font-medium">Weigh Now</span>
                        </button>
                        <button onclick="openMeasurementModal('height')"
                                class="btn-hover-effect bg-pastel-accent1 text-white p-4 rounded-2xl shadow-pastel transition-all duration-300 hover:bg-pastel-accent1/90 hover:transform hover:-translate-y-0.5">
                            <i data-lucide="maximize-2" class="h-6 w-6 mb-2 mx-auto"></i>
                            <span class="block text-sm font-medium">Measure Height</span>
                        </button>
                        <button onclick="openMeasurementModal('head')"
                                class="btn-hover-effect bg-pastel-accent2 text-white p-4 rounded-2xl shadow-pastel transition-all duration-300 hover:bg-pastel-accent2/90 hover:transform hover:-translate-y-0.5">
                            <i data-lucide="circle" class="h-6 w-6 mb-2 mx-auto"></i>
                            <span class="block text-sm font-medium">Head Circumference</span>
                        </button>
                    </div>

                    <!-- Input Methods -->
                    <div class="flex flex-wrap gap-4 justify-center">
                        <button class="flex items-center gap-2 px-4 py-2 bg-pastel-light rounded-full text-sm hover:bg-pastel-secondary transition-colors">
                            <i data-lucide="bluetooth" class="h-4 w-4"></i>
                            Smart Scale
                        </button>
                        <button onclick="openMeasurementModal()"
                                class="flex items-center gap-2 px-4 py-2 bg-pastel-light rounded-full text-sm hover:bg-pastel-secondary transition-colors">
                            <i data-lucide="keyboard" class="h-4 w-4"></i>
                            Manual Entry
                        </button>
                        <button class="flex items-center gap-2 px-4 py-2 bg-pastel-light rounded-full text-sm hover:bg-pastel-secondary transition-colors">
                            <i data-lucide="mic" class="h-4 w-4"></i>
                            Voice Input
                        </button>
                    </div>
                </div>

                <!-- Weight Tracking Section -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                     style="animation-delay: 0.9s; animation-fill-mode: forwards;">
                    <h3 class="text-lg font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                        <i data-lucide="weight" class="h-5 w-5 text-pastel-primary"></i>
                        Weight Tracking
                    </h3>

                    <!-- Current Weight Display -->
                    <div class="text-center mb-6">
                        <p class="text-5xl font-bold text-pastel-heading font-serif mb-2">
                            <span id="currentWeight">--</span>
                            <span class="text-2xl font-normal text-pastel-textLight ml-1 weight-unit">kg</span>
                        </p>
                        <p class="text-sm text-pastel-textLight" id="weightChangeDetail">
                            No previous measurements
                        </p>
                    </div>

                    <!-- Visual Weight Representation -->
                    <div class="bg-pastel-lightest rounded-xl p-4 text-center">
                        <div class="inline-flex items-center justify-center w-32 h-32 rounded-full bg-pastel-secondary animate-pulse-soft">
                            <i data-lucide="baby" class="h-16 w-16 text-pastel-primary"></i>
                        </div>
                    </div>
                </div>

                <!-- Height/Length Tracking -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                     style="animation-delay: 1.0s; animation-fill-mode: forwards;">
                    <h3 class="text-lg font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                        <i data-lucide="maximize-2" class="h-5 w-5 text-pastel-accent1"></i>
                        Height/Length Tracking
                    </h3>

                    <!-- Height Display -->
                    <div class="text-center mb-6">
                        <p class="text-5xl font-bold text-pastel-heading font-serif mb-2">
                            <span id="currentHeight">--</span>
                            <span class="text-2xl font-normal text-pastel-textLight ml-1 height-unit">cm</span>
                        </p>
                        <p class="text-sm text-pastel-textLight" id="heightChangeDetail">
                            No previous measurements
                        </p>
                    </div>

                    <!-- Measurement Tips -->
                    <div class="bg-pastel-lightest rounded-xl p-4 text-sm text-pastel-text">
                        <p class="font-medium mb-2">üìè Measurement Tips:</p>
                        <ul class="space-y-1 text-xs">
                            <li>‚Ä¢ Place baby on a flat surface</li>
                            <li>‚Ä¢ Ensure legs are fully extended</li>
                            <li>‚Ä¢ Measure from crown to heel</li>
                        </ul>
                    </div>
                </div>

                <!-- Head Circumference -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                     style="animation-delay: 1.1s; animation-fill-mode: forwards;">
                    <h3 class="text-lg font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                        <i data-lucide="circle" class="h-5 w-5 text-pastel-accent2"></i>
                        Head Circumference
                    </h3>

                    <!-- Circular Visual Indicator -->
                    <div class="text-center mb-6">
                        <div class="relative inline-block">
                            <svg class="w-40 h-40" viewBox="0 0 160 160">
                                <circle cx="80" cy="80" r="70" fill="none" stroke="#ffe8d9" stroke-width="10"/>
                                <circle cx="80" cy="80" r="70" fill="none" stroke="#fec89a" stroke-width="10"
                                        stroke-dasharray="440" stroke-dashoffset="110" transform="rotate(-90 80 80)"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div>
                                    <p class="text-3xl font-bold text-pastel-heading font-serif" id="currentHeadCirc">
                                        --</p>
                                    <p class="text-sm text-pastel-textLight height-unit">cm</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Measurement Guide -->
                    <div class="bg-pastel-lightest rounded-xl p-4 text-sm">
                        <p class="font-medium text-pastel-text mb-2">How to Measure:</p>
                        <ol class="text-xs text-pastel-textLight space-y-1">
                            <li>1. Place tape above eyebrows and ears</li>
                            <li>2. Circle around the widest part of the head</li>
                            <li>3. Keep tape snug but not tight</li>
                            <li>4. Read measurement where tape overlaps</li>
                        </ol>
                    </div>
                </div>

                <!-- Growth Charts -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                     style="animation-delay: 1.3s; animation-fill-mode: forwards;">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-serif font-medium text-pastel-heading flex items-center gap-2">
                            <i data-lucide="trending-up" class="h-5 w-5 text-pastel-accent2"></i>
                            Growth Charts
                        </h3>
                        <select id="chartTypeSelector"
                                class="text-sm bg-pastel-light rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-pastel-primary">
                            <option value="weight">Weight-for-age</option>
                            <option value="height">Length-for-age</option>
                            <option value="head">Head circumference-for-age</option>
                        </select>
                    </div>

                    <div class="h-64 mb-4">
                        <canvas id="growthChart"></canvas>
                    </div>

                    <!-- Chart Actions -->
                    <div class="flex flex-wrap gap-2 justify-center">
                        <button onclick="exportChart()"
                                class="flex items-center gap-2 px-3 py-1.5 bg-pastel-light rounded-full text-sm hover:bg-pastel-secondary transition-colors">
                            <i data-lucide="download" class="h-4 w-4"></i>
                            Export
                        </button>
                        <button onclick="shareChart()"
                                class="flex items-center gap-2 px-3 py-1.5 bg-pastel-light rounded-full text-sm hover:bg-pastel-secondary transition-colors">
                            <i data-lucide="share-2" class="h-4 w-4"></i>
                            Share
                        </button>
                    </div>
                </div>

                <!-- Measurement History -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                     style="animation-delay: 1.4s; animation-fill-mode: forwards;">
                    <h3 class="text-lg font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                        <i data-lucide="history" class="h-5 w-5 text-pastel-accent1"></i>
                        Measurement History
                    </h3>

                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                            <tr class="border-b border-pastel-light">
                                <th class="text-left py-2 px-3 font-medium text-pastel-textLight">Date</th>
                                <th class="text-left py-2 px-3 font-medium text-pastel-textLight">Weight</th>
                                <th class="text-left py-2 px-3 font-medium text-pastel-textLight">Height</th>
                                <th class="text-left py-2 px-3 font-medium text-pastel-textLight">Head</th>
                                <th class="text-center py-2 px-3 font-medium text-pastel-textLight">Actions</th>
                            </tr>
                            </thead>
                            <tbody id="measurementHistoryBody">
                            <!-- Measurement history will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-4 text-center">
                        <button onclick="loadMoreHistory()" class="text-sm text-pastel-primary hover:underline">View All
                            History
                        </button>
                    </div>
                </div>

                <!-- Alerts and Recommendations -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                     style="animation-delay: 1.5s; animation-fill-mode: forwards;">
                    <h3 class="text-lg font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                        <i data-lucide="alert-circle" class="h-5 w-5 text-pastel-warning"></i>
                        Growth Insights & Recommendations
                    </h3>

                    <div class="space-y-3" id="growthRecommendations">
                        <!-- Recommendations will be populated here -->
                    </div>
                </div>

                <!-- Sharing and Export -->
                <div class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up"
                     style="animation-delay: 1.6s; animation-fill-mode: forwards;">
                    <h3 class="text-lg font-serif font-medium text-pastel-heading mb-4 flex items-center gap-2">
                        <i data-lucide="share-2" class="h-5 w-5 text-pastel-primary"></i>
                        Share & Export
                    </h3>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button onclick="generatePDFReport()"
                                class="flex items-center justify-center gap-3 p-4 bg-pastel-lightest rounded-xl hover:bg-pastel-light transition-colors">
                            <i data-lucide="file-text" class="h-5 w-5 text-pastel-primary"></i>
                            <span class="text-sm font-medium">Generate PDF Report</span>
                        </button>
                        <button onclick="emailToDoctor()"
                                class="flex items-center justify-center gap-3 p-4 bg-pastel-lightest rounded-xl hover:bg-pastel-light transition-colors">
                            <i data-lucide="mail" class="h-5 w-5 text-pastel-accent1"></i>
                            <span class="text-sm font-medium">Email to Doctor</span>
                        </button>
                        <button onclick="printSummary()"
                                class="flex items-center justify-center gap-3 p-4 bg-pastel-lightest rounded-xl hover:bg-pastel-light transition-colors">
                            <i data-lucide="printer" class="h-5 w-5 text-pastel-accent2"></i>
                            <span class="text-sm font-medium">Print Summary</span>
                        </button>
                        <button onclick="prepareDoctorVisit()"
                                class="flex items-center justify-center gap-3 p-4 bg-pastel-lightest rounded-xl hover:bg-pastel-light transition-colors">
                            <i data-lucide="clipboard" class="h-5 w-5 text-pastel-text"></i>
                            <span class="text-sm font-medium">Doctor Visit Prep</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Decorative floating elements -->
            <div class="fixed bottom-20 right-10 w-32 h-32 rounded-full bg-pastel-accent1 opacity-10 animate-float pointer-events-none"></div>
            <div class="fixed top-40 right-1/4 w-24 h-24 rounded-full bg-pastel-accent2 opacity-10 animate-float-delayed pointer-events-none"></div>
        </section>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="lg:hidden border-t border-pastel-light bg-white/80 backdrop-blur-lg">
            <div class="grid grid-cols-4 gap-1">
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="home" class="h-5 w-5"></i>
                    <span class="text-xs">Home</span>
                </button>
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-primary">
                    <i data-lucide="bar-chart-3" class="h-5 w-5"></i>
                    <span class="text-xs">Insights</span>
                </button>
                <button onclick="openMeasurementModal()"
                        class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="plus-circle" class="h-5 w-5"></i>
                    <span class="text-xs">Add</span>
                </button>
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="user" class="h-5 w-5"></i>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
        </nav>
    </div>
</div>

<script src="../js/auth.js" data-auto-init="true"></script>
<script>
    // Global variables for storing app state
    let currentBaby = null;
    let currentUser = null;
    let measurements = [];
    let currentUnit = 'metric';
    let growthChart = null;
    let editingMeasurementId = null;

    // Initialize the application
    document.addEventListener('DOMContentLoaded', async () => {
        // Initialize Lucide icons
        lucide.createIcons();

        // Initialize mobile menu
        initializeMobileMenu();

        // Initialize unit selector
        initializeUnitSelector();

        // Initialize chart type selector
        initializeChartSelector();

        // Load user data and babies
        await loadUserData();
        await loadBabies();

        // Initialize measurement form
        initializeMeasurementForm();

        // Set default datetime to now
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('measurementDate').value = now.toISOString().slice(0, 16);

        // Add keyboard shortcuts
        initializeKeyboardShortcuts();
    });

    // Mobile menu toggle functionality
    function initializeMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        function toggleMobileMenu() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        overlay.addEventListener('click', toggleMobileMenu);
    }

    // Unit selector functionality
    function initializeUnitSelector() {
        const metricBtn = document.getElementById('metricBtn');
        const imperialBtn = document.getElementById('imperialBtn');

        metricBtn.addEventListener('click', () => setUnit('metric'));
        imperialBtn.addEventListener('click', () => setUnit('imperial'));
    }

    function setUnit(unit) {
        currentUnit = unit;
        const metricBtn = document.getElementById('metricBtn');
        const imperialBtn = document.getElementById('imperialBtn');

        if (unit === 'metric') {
            metricBtn.classList.add('bg-white', 'text-pastel-primary', 'shadow-pastel');
            metricBtn.classList.remove('text-pastel-text');
            imperialBtn.classList.remove('bg-white', 'text-pastel-primary', 'shadow-pastel');
            imperialBtn.classList.add('text-pastel-text');
        } else {
            imperialBtn.classList.add('bg-white', 'text-pastel-primary', 'shadow-pastel');
            imperialBtn.classList.remove('text-pastel-text');
            metricBtn.classList.remove('bg-white', 'text-pastel-primary', 'shadow-pastel');
            metricBtn.classList.add('text-pastel-text');
        }

        updateUnits();
        displayCurrentMeasurements();
        updateGrowthChart();
    }

    function updateUnits() {
        const weightUnit = currentUnit === 'metric' ? 'kg' : 'lbs';
        const heightUnit = currentUnit === 'metric' ? 'cm' : 'in';

        document.querySelectorAll('.weight-unit').forEach(el => el.textContent = weightUnit);
        document.querySelectorAll('.height-unit').forEach(el => el.textContent = heightUnit);
    }

    // Convert measurements between units
    function convertWeight(value, toImperial = false) {
        return toImperial ? (value * 2.20462).toFixed(2) : (value / 2.20462).toFixed(2);
    }

    function convertHeight(value, toImperial = false) {
        return toImperial ? (value * 0.393701).toFixed(1) : (value / 0.393701).toFixed(1);
    }

    // Load user data
    async function loadUserData() {
        try {
            currentUser = await BabyHelperAuth.api.endpoints.getUserProfile();

            // Update user avatar
            const userAvatar = document.getElementById('userAvatar');
            if (currentUser && currentUser.name) {
                const initials = currentUser.name.split(' ')
                    .map(word => word[0])
                    .join('')
                    .toUpperCase()
                    .slice(0, 2);
                userAvatar.textContent = initials;
            }
        } catch (error) {
            console.error('Failed to load user data:', error);
        }
    }

    // Load babies and select one
    async function loadBabies() {
        showLoading();
        try {
            const babies = await BabyHelperAuth.api.endpoints.getBabies();

            if (babies && babies.length > 0) {
                // Select the first baby or previously selected one
                const savedBabyId = localStorage.getItem('selectedBabyId');
                currentBaby = babies.find(b => b.id == savedBabyId) || babies[0];

                updateBabyInfo();
                await loadMeasurements();
            } else {
                // No babies found
                document.getElementById('babyName').textContent = 'No baby added';
                document.getElementById('babyAge').textContent = 'Add a baby to start';
                showNoDataMessage();
            }
        } catch (error) {
            console.error('Failed to load babies:', error);
            showError('Failed to load baby data');
        } finally {
            hideLoading();
        }
    }

    // Update baby info display
    function updateBabyInfo() {
        if (!currentBaby) return;

        document.getElementById('babyName').textContent = currentBaby.name;
        document.getElementById('babyAge').textContent = calculateAge(currentBaby.date_of_birth);

        // Save selected baby
        localStorage.setItem('selectedBabyId', currentBaby.id);

        // Make baby info clickable to change selection
        document.getElementById('babyInfo').onclick = openBabySelector;
    }

    // Calculate age from date of birth
    function calculateAge(dateOfBirth) {
        const today = new Date();
        const birthDate = new Date(dateOfBirth);
        const monthsDiff = (today.getFullYear() - birthDate.getFullYear()) * 12 +
            (today.getMonth() - birthDate.getMonth());

        if (monthsDiff < 1) {
            const daysDiff = Math.floor((today - birthDate) / (1000 * 60 * 60 * 24));
            return `${daysDiff} days`;
        } else if (monthsDiff < 24) {
            return `${monthsDiff} months`;
        } else {
            const years = Math.floor(monthsDiff / 12);
            const months = monthsDiff % 12;
            return months > 0 ? `${years} years ${months} months` : `${years} years`;
        }
    }

    // Baby selector
    async function openBabySelector() {
        const babies = await BabyHelperAuth.api.endpoints.getBabies();
        const babyList = document.getElementById('babyList');

        babyList.innerHTML = babies.map(baby => `
            <button onclick="selectBaby(${baby.id})"
                    class="w-full text-left p-3 rounded-xl hover:bg-pastel-light transition-colors ${baby.id === currentBaby?.id ? 'bg-pastel-light' : ''}">
                <div class="font-medium">${baby.name}</div>
                <div class="text-sm text-pastel-textLight">${calculateAge(baby.date_of_birth)}</div>
            </button>
        `).join('');

        document.getElementById('babySelectorModal').classList.remove('hidden');
    }

    function closeBabySelector() {
        document.getElementById('babySelectorModal').classList.add('hidden');
    }

    async function selectBaby(babyId) {
        const babies = await BabyHelperAuth.api.endpoints.getBabies();
        currentBaby = babies.find(b => b.id === babyId);

        if (currentBaby) {
            updateBabyInfo();
            await loadMeasurements();
            closeBabySelector();
        }
    }

    // Load growth measurements
    async function loadMeasurements() {
        if (!currentBaby) return;

        showLoading();
        try {
            const response = await BabyHelperAuth.api.request(`/growth/baby/${currentBaby.id}`);

            if (response.ok) {
                measurements = await response.json();

                // Update displays
                displayCurrentMeasurements();
                displayMeasurementHistory();
                updateGrowthChart();
                updateStatistics();
                generateRecommendations();

                // Update last updated time
                document.getElementById('lastUpdated').textContent = formatTimeAgo(new Date());
            } else {
                const error = await BabyHelperAuth.api.parseErrorResponse(response);
                console.error('Failed to load measurements:', error);
                measurements = [];
                showNoDataMessage();
            }
        } catch (error) {
            console.error('Request failed:', error);
            measurements = [];
            showError('Failed to load measurements');
        } finally {
            hideLoading();
        }
    }

    // Display current measurements
    function displayCurrentMeasurements() {
        if (measurements.length === 0) {
            document.getElementById('currentWeight').textContent = '--';
            document.getElementById('currentWeightValue').textContent = '--';
            document.getElementById('weightChange').textContent = '--';
            document.getElementById('weightChangeDetail').textContent = 'No measurements recorded';

            document.getElementById('currentHeight').textContent = '--';
            document.getElementById('currentHeightValue').textContent = '--';
            document.getElementById('heightChange').textContent = '--';
            document.getElementById('heightChangeDetail').textContent = 'No measurements recorded';

            document.getElementById('currentHeadCirc').textContent = '--';
            document.getElementById('currentHeadValue').textContent = '--';
            document.getElementById('headChange').textContent = '--';

            return;
        }

        // Get the most recent measurement
        const latest = measurements[0];
        const previous = measurements[1];

        // Weight
        if (latest.weight !== null) {
            const weight = currentUnit === 'metric' ? latest.weight : convertWeight(latest.weight, true);
            document.getElementById('currentWeight').textContent = weight;
            document.getElementById('currentWeightValue').textContent = weight;

            if (previous && previous.weight !== null) {
                const change = latest.weight - previous.weight;
                const changeStr = change >= 0 ? `+${change.toFixed(2)}` : change.toFixed(2);
                const changeClass = change >= 0 ? 'text-pastel-success' : 'text-pastel-warning';

                document.getElementById('weightChange').innerHTML = `<span class="${changeClass}">${changeStr} ${currentUnit === 'metric' ? 'kg' : 'lbs'}</span>`;
                document.getElementById('weightChangeDetail').innerHTML = `<span class="${changeClass}">${changeStr} ${currentUnit === 'metric' ? 'kg' : 'lbs'}</span> since ${formatDate(previous.measurement_date)}`;
            }
        }

        // Height
        if (latest.height !== null) {
            const height = currentUnit === 'metric' ? latest.height : convertHeight(latest.height, true);
            document.getElementById('currentHeight').textContent = height;
            document.getElementById('currentHeightValue').textContent = height;

            if (previous && previous.height !== null) {
                const change = latest.height - previous.height;
                const changeStr = change >= 0 ? `+${change.toFixed(1)}` : change.toFixed(1);
                const changeClass = change >= 0 ? 'text-pastel-success' : 'text-pastel-warning';

                document.getElementById('heightChange').innerHTML = `<span class="${changeClass}">${changeStr} ${currentUnit === 'metric' ? 'cm' : 'in'}</span>`;
                document.getElementById('heightChangeDetail').innerHTML = `<span class="${changeClass}">${changeStr} ${currentUnit === 'metric' ? 'cm' : 'in'}</span> since ${formatDate(previous.measurement_date)}`;
            }
        }

        // Head circumference
        if (latest.head_circumference !== null) {
            const head = currentUnit === 'metric' ? latest.head_circumference : convertHeight(latest.head_circumference, true);
            document.getElementById('currentHeadCirc').textContent = head;
            document.getElementById('currentHeadValue').textContent = head;

            if (previous && previous.head_circumference !== null) {
                const change = latest.head_circumference - previous.head_circumference;
                const changeStr = change >= 0 ? `+${change.toFixed(1)}` : change.toFixed(1);
                const changeClass = change >= 0 ? 'text-pastel-success' : 'text-pastel-warning';

                document.getElementById('headChange').innerHTML = `<span class="${changeClass}">${changeStr} ${currentUnit === 'metric' ? 'cm' : 'in'}</span>`;
            }
        }
    }

    // Display measurement history
    function displayMeasurementHistory() {
        const tbody = document.getElementById('measurementHistoryBody');

        if (measurements.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center py-8 text-pastel-textLight">
                        No measurements recorded yet. Click "Add New Entry" to start tracking!
                    </td>
                </tr>
            `;
            return;
        }

        // Display first 10 measurements
        const displayMeasurements = measurements.slice(0, 10);

        tbody.innerHTML = displayMeasurements.map(m => {
            const weight = m.weight !== null ?
                `${currentUnit === 'metric' ? m.weight : convertWeight(m.weight, true)} ${currentUnit === 'metric' ? 'kg' : 'lbs'}` :
                '--';
            const height = m.height !== null ?
                `${currentUnit === 'metric' ? m.height : convertHeight(m.height, true)} ${currentUnit === 'metric' ? 'cm' : 'in'}` :
                '--';
            const head = m.head_circumference !== null ?
                `${currentUnit === 'metric' ? m.head_circumference : convertHeight(m.head_circumference, true)} ${currentUnit === 'metric' ? 'cm' : 'in'}` :
                '--';

            return `
                <tr class="border-b border-pastel-light hover:bg-pastel-lightest transition-colors">
                    <td class="py-3 px-3">${formatDate(m.measurement_date)}</td>
                    <td class="py-3 px-3">${weight}</td>
                    <td class="py-3 px-3">${height}</td>
                    <td class="py-3 px-3">${head}</td>
                    <td class="py-3 px-3 text-center">
                        <button onclick="editMeasurement(${m.id})" class="text-pastel-primary hover:text-pastel-primaryHover mr-2">
                            <i data-lucide="edit-2" class="h-4 w-4"></i>
                        </button>
                        <button onclick="deleteMeasurement(${m.id})" class="text-pastel-danger hover:text-red-700">
                            <i data-lucide="trash-2" class="h-4 w-4"></i>
                        </button>
                    </td>
                </tr>
            `;
        }).join('');

        // Re-render icons
        lucide.createIcons();
    }

    // Update statistics
    function updateStatistics() {
        document.getElementById('totalMeasurements').textContent = measurements.length;

        // Calculate key insights
        if (measurements.length > 0) {
            const latest = measurements[0];
            const insights = [];

            if (latest.weight !== null && measurements.length > 1) {
                const weightGain = calculateAverageGain(measurements, 'weight');
                if (weightGain > 0) {
                    insights.push(`${currentBaby.name} has been gaining an average of <span class="font-semibold text-pastel-primary">${weightGain.toFixed(2)} ${currentUnit === 'metric' ? 'kg' : 'lbs'} per month</span>.`);
                }
            }

            if (latest.height !== null && measurements.length > 1) {
                const heightGain = calculateAverageGain(measurements, 'height');
                if (heightGain > 0) {
                    insights.push(`Growing at an average rate of <span class="font-semibold text-pastel-primary">${heightGain.toFixed(1)} ${currentUnit === 'metric' ? 'cm' : 'inches'} per month</span>.`);
                }
            }

            if (insights.length > 0) {
                document.getElementById('keyInsights').innerHTML = insights.join(' ') + ' <span class="text-pastel-accent1 font-medium">Keep up the great work! üåü</span>';
            } else {
                document.getElementById('keyInsights').innerHTML = `Start tracking ${currentBaby.name}'s growth regularly to see insights and trends. <span class="text-pastel-accent1 font-medium">Every measurement counts! üìä</span>`;
            }
        }
    }

    // Calculate average gain per month
    function calculateAverageGain(measurements, field) {
        const validMeasurements = measurements.filter(m => m[field] !== null);
        if (validMeasurements.length < 2) return 0;

        const latest = validMeasurements[0];
        const oldest = validMeasurements[validMeasurements.length - 1];

        const monthsDiff = (new Date(latest.measurement_date) - new Date(oldest.measurement_date)) / (1000 * 60 * 60 * 24 * 30);

        if (monthsDiff === 0) return 0;

        return (latest[field] - oldest[field]) / monthsDiff;
    }

    // Generate growth recommendations
    function generateRecommendations() {
        const recommendations = document.getElementById('growthRecommendations');
        const items = [];

        if (measurements.length === 0) {
            items.push({
                type: 'info',
                icon: 'info',
                title: 'Get Started',
                text: 'Start tracking your baby\'s growth by adding your first measurement!'
            });
        } else {
            // Check measurement frequency
            if (measurements.length > 0) {
                const daysSinceLastMeasurement = (new Date() - new Date(measurements[0].measurement_date)) / (1000 * 60 * 60 * 24);

                if (daysSinceLastMeasurement > 30) {
                    items.push({
                        type: 'warning',
                        icon: 'alert-circle',
                        title: 'Time for a Check-up',
                        text: `It's been ${Math.floor(daysSinceLastMeasurement)} days since the last measurement. Regular tracking helps monitor healthy growth.`
                    });
                }
            }

            // Growth pattern analysis
            if (measurements.length > 2) {
                items.push({
                    type: 'success',
                    icon: 'check-circle',
                    title: 'Consistent Tracking',
                    text: `You've recorded ${measurements.length} measurements. This data helps track ${currentBaby.name}'s growth patterns effectively.`
                });
            }

            // Age-specific recommendations
            const ageMonths = getAgeInMonths(currentBaby.date_of_birth);
            if (ageMonths < 12) {
                items.push({
                    type: 'info',
                    icon: 'lightbulb',
                    title: 'Growth Tips',
                    text: 'During the first year, babies typically triple their birth weight and grow about 10 inches in length.'
                });
            }
        }

        recommendations.innerHTML = items.map(item => `
            <div class="bg-pastel-${item.type === 'success' ? 'success' : item.type === 'warning' ? 'warning' : 'lightest'}/10 rounded-xl p-4 border border-pastel-${item.type === 'success' ? 'success' : item.type === 'warning' ? 'warning' : 'light'}/20">
                <div class="flex items-start gap-3">
                    <i data-lucide="${item.icon}" class="h-5 w-5 text-pastel-${item.type === 'success' ? 'success' : item.type === 'warning' ? 'warning' : 'accent2'} mt-0.5"></i>
                    <div>
                        <p class="font-medium text-pastel-text">${item.title}</p>
                        <p class="text-sm text-pastel-textLight mt-1">${item.text}</p>
                    </div>
                </div>
            </div>
        `).join('');

        // Re-render icons
        lucide.createIcons();
    }

    // Get age in months
    function getAgeInMonths(dateOfBirth) {
        const today = new Date();
        const birthDate = new Date(dateOfBirth);
        return (today.getFullYear() - birthDate.getFullYear()) * 12 +
            (today.getMonth() - birthDate.getMonth());
    }

    // Chart functionality
    function initializeChartSelector() {
        document.getElementById('chartTypeSelector').addEventListener('change', updateGrowthChart);
    }

    function updateGrowthChart() {
        const chartType = document.getElementById('chartTypeSelector').value;
        const ctx = document.getElementById('growthChart').getContext('2d');

        // Destroy existing chart
        if (growthChart) {
            growthChart.destroy();
        }

        // Prepare data
        const chartData = prepareChartData(chartType);

        if (!chartData) {
            // No data available
            ctx.font = '14px Nunito Sans';
            ctx.fillStyle = '#938278';
            ctx.textAlign = 'center';
            ctx.fillText('No data available for this chart', ctx.canvas.width / 2, ctx.canvas.height / 2);
            return;
        }

        // Chart.js configuration
        Chart.defaults.color = '#938278';
        Chart.defaults.borderColor = '#ffe8d9';
        Chart.defaults.font.family = "'Nunito Sans', sans-serif";

        growthChart = new Chart(ctx, {
            type: 'line',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 15,
                            font: {
                                size: 12
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            callback: function (value) {
                                const unit = chartType === 'weight' ?
                                    (currentUnit === 'metric' ? ' kg' : ' lbs') :
                                    (currentUnit === 'metric' ? ' cm' : ' in');
                                return value + unit;
                            }
                        },
                        grid: {
                            color: '#ffe8d9'
                        }
                    },
                    x: {
                        grid: {
                            color: '#ffe8d9'
                        }
                    }
                }
            }
        });
    }

    function prepareChartData(type) {
        let field;
        let label;
        let color;

        switch (type) {
            case 'weight':
                field = 'weight';
                label = 'Weight';
                color = '#ff8c69';
                break;
            case 'height':
                field = 'height';
                label = 'Height';
                color = '#ffb5a7';
                break;
            case 'head':
                field = 'head_circumference';
                label = 'Head Circumference';
                color = '#fec89a';
                break;
        }

        const validMeasurements = measurements.filter(m => m[field] !== null).reverse();

        if (validMeasurements.length === 0) {
            return null;
        }

        const labels = validMeasurements.map(m => formatShortDate(m.measurement_date));
        const data = validMeasurements.map(m => {
            const value = m[field];
            if (type === 'weight' && currentUnit === 'imperial') {
                return parseFloat(convertWeight(value, true));
            } else if ((type === 'height' || type === 'head') && currentUnit === 'imperial') {
                return parseFloat(convertHeight(value, true));
            }
            return value;
        });

        return {
            labels: labels,
            datasets: [{
                label: `${currentBaby.name}'s ${label}`,
                data: data,
                borderColor: color,
                backgroundColor: color + '20',
                fill: true,
                tension: 0.4,
                pointBackgroundColor: color,
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        };
    }

    // Measurement modal functions
    function openMeasurementModal(focusField = null) {
        editingMeasurementId = null;
        document.getElementById('measurementForm').reset();

        // Set default datetime to now
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('measurementDate').value = now.toISOString().slice(0, 16);

        // Focus on specific field if requested
        if (focusField) {
            setTimeout(() => {
                switch (focusField) {
                    case 'weight':
                        document.getElementById('measurementWeight').focus();
                        break;
                    case 'height':
                        document.getElementById('measurementHeight').focus();
                        break;
                    case 'head':
                        document.getElementById('measurementHead').focus();
                        break;
                }
            }, 100);
        }

        document.getElementById('measurementModal').classList.remove('hidden');
    }

    function closeMeasurementModal() {
        document.getElementById('measurementModal').classList.add('hidden');
        editingMeasurementId = null;
    }

    // Initialize measurement form
    function initializeMeasurementForm() {
        document.getElementById('measurementForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!currentBaby) {
                showError('Please select a baby first');
                return;
            }

            const formData = {
                baby_id: currentBaby.id,
                measurement_date: new Date(document.getElementById('measurementDate').value).toISOString(),
                weight: parseFloat(document.getElementById('measurementWeight').value) || null,
                height: parseFloat(document.getElementById('measurementHeight').value) || null,
                head_circumference: parseFloat(document.getElementById('measurementHead').value) || null,
                notes: document.getElementById('measurementNotes').value || null
            };

            // Convert from imperial if needed
            if (currentUnit === 'imperial') {
                if (formData.weight !== null) {
                    formData.weight = parseFloat(convertWeight(formData.weight, false));
                }
                if (formData.height !== null) {
                    formData.height = parseFloat(convertHeight(formData.height, false));
                }
                if (formData.head_circumference !== null) {
                    formData.head_circumference = parseFloat(convertHeight(formData.head_circumference, false));
                }
            }

            // Validate at least one measurement
            if (formData.weight === null && formData.height === null && formData.head_circumference === null) {
                showError('Please enter at least one measurement');
                return;
            }

            showLoading();

            try {
                let response;
                if (editingMeasurementId) {
                    // Update existing measurement
                    response = await BabyHelperAuth.api.request(`/growth/${editingMeasurementId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                } else {
                    // Create new measurement
                    response = await BabyHelperAuth.api.request('/growth/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                }

                if (response.ok) {
                    closeMeasurementModal();
                    await loadMeasurements();
                    showSuccess(editingMeasurementId ? 'Measurement updated successfully!' : 'Measurement added successfully!');
                } else {
                    const error = await BabyHelperAuth.api.parseErrorResponse(response);
                    showError(error.message || 'Failed to save measurement');
                }
            } catch (error) {
                console.error('Failed to save measurement:', error);
                showError('Failed to save measurement');
            } finally {
                hideLoading();
            }
        });
    }

    // Edit measurement
    async function editMeasurement(measurementId) {
        const measurement = measurements.find(m => m.id === measurementId);
        if (!measurement) return;

        editingMeasurementId = measurementId;

        // Fill form with existing data
        const date = new Date(measurement.measurement_date);
        date.setMinutes(date.getMinutes() - date.getTimezoneOffset());
        document.getElementById('measurementDate').value = date.toISOString().slice(0, 16);

        if (measurement.weight !== null) {
            document.getElementById('measurementWeight').value = currentUnit === 'metric' ?
                measurement.weight : convertWeight(measurement.weight, true);
        }

        if (measurement.height !== null) {
            document.getElementById('measurementHeight').value = currentUnit === 'metric' ?
                measurement.height : convertHeight(measurement.height, true);
        }

        if (measurement.head_circumference !== null) {
            document.getElementById('measurementHead').value = currentUnit === 'metric' ?
                measurement.head_circumference : convertHeight(measurement.head_circumference, true);
        }

        document.getElementById('measurementNotes').value = measurement.notes || '';

        document.getElementById('measurementModal').classList.remove('hidden');
    }

    // Delete measurement
    async function deleteMeasurement(measurementId) {
        if (!confirm('Are you sure you want to delete this measurement?')) {
            return;
        }

        showLoading();

        try {
            const response = await BabyHelperAuth.api.request(`/growth/${measurementId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                await loadMeasurements();
                showSuccess('Measurement deleted successfully!');
            } else {
                const error = await BabyHelperAuth.api.parseErrorResponse(response);
                showError(error.message || 'Failed to delete measurement');
            }
        } catch (error) {
            console.error('Failed to delete measurement:', error);
            showError('Failed to delete measurement');
        } finally {
            hideLoading();
        }
    }

    // Export functions (placeholders for future implementation)
    function exportChart() {
        // TODO: Implement chart export functionality
        showInfo('Chart export feature coming soon!');
    }

    function shareChart() {
        // TODO: Implement chart sharing functionality
        showInfo('Chart sharing feature coming soon!');
    }

    function generatePDFReport() {
        // TODO: Implement PDF generation
        showInfo('PDF report generation coming soon!');
    }

    function emailToDoctor() {
        // TODO: Implement email functionality
        showInfo('Email to doctor feature coming soon!');
    }

    function printSummary() {
        // TODO: Implement print functionality
        window.print();
    }

    function prepareDoctorVisit() {
        // TODO: Implement doctor visit preparation
        showInfo('Doctor visit preparation feature coming soon!');
    }

    function loadMoreHistory() {
        // TODO: Implement pagination for history
        showInfo('Load more feature coming soon!');
    }

    // Utility functions
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric',
            year: 'numeric'
        });
    }

    function formatShortDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric'
        });
    }

    function formatTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);

        if (diffMins < 1) return 'just now';
        if (diffMins < 60) return `${diffMins} minutes ago`;

        const diffHours = Math.floor(diffMins / 60);
        if (diffHours < 24) return `${diffHours} hours ago`;

        const diffDays = Math.floor(diffHours / 24);
        return `${diffDays} days ago`;
    }

    // UI feedback functions
    function showLoading() {
        document.getElementById('loadingOverlay').classList.add('show');
    }

    function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('show');
    }

    function showSuccess(message) {
        // TODO: Implement toast notification
        console.log('Success:', message);
    }

    function showError(message) {
        // TODO: Implement toast notification
        console.error('Error:', message);
        alert(message);
    }

    function showInfo(message) {
        // TODO: Implement toast notification
        alert(message);
    }

    function showNoDataMessage() {
        document.getElementById('keyInsights').innerHTML =
            `Welcome to ${currentBaby ? currentBaby.name + "'s" : "your baby's"} growth tracker! Start by adding your first measurement to track growth patterns.`;
    }

    // Keyboard shortcuts
    function initializeKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            // Cmd/Ctrl + A to add new entry
            if ((e.metaKey || e.ctrlKey) && e.key === 'a') {
                e.preventDefault();
                openMeasurementModal();
            }
        });
    }

    // Add smooth scroll behavior
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({behavior: 'smooth'});
            }
        });
    });
</script>
</body>
</html>