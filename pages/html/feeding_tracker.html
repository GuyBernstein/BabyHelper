<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BabyHelper - Feeding Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700&family=Lora:wght@400;500;600&display=swap"
          rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/lucide@latest"></script>
    <script>
        // Tailwind configuration with pastel theme
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pastel: {
                            lightest: '#fdf6f0',
                            light: '#ffe8d9',
                            primary: '#ff8c69',
                            primaryHover: '#ff7043',
                            secondary: '#ffd8cc',
                            accent1: '#ffb5a7',
                            accent2: '#fec89a',
                            text: '#6d5d52',
                            textLight: '#938278',
                            heading: '#5c4d44'
                        }
                    },
                    fontFamily: {
                        sans: ['Nunito Sans', 'sans-serif'],
                        serif: ['Lora', 'serif']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 2s infinite',
                        'fade-in-up': 'fadeInUp 1s ease-out forwards',
                        'fade-in-right': 'fadeInRight 1s ease-out forwards',
                        'fade-in-left': 'fadeInLeft 1s ease-out forwards',
                        'fade-in': 'fadeIn 1.2s ease-out forwards',
                        'pulse-ring': 'pulseRing 1.5s ease-out infinite',
                        'grow-circle': 'growCircle 1s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': {transform: 'translateY(0)'},
                            '50%': {transform: 'translateY(-20px)'},
                        },
                        fadeInUp: {
                            '0%': {opacity: '0', transform: 'translateY(20px)'},
                            '100%': {opacity: '1', transform: 'translateY(0)'},
                        },
                        fadeInRight: {
                            '0%': {opacity: '0', transform: 'translateX(-20px)'},
                            '100%': {opacity: '1', transform: 'translateX(0)'},
                        },
                        fadeInLeft: {
                            '0%': {opacity: '0', transform: 'translateX(20px)'},
                            '100%': {opacity: '1', transform: 'translateX(0)'},
                        },
                        fadeIn: {
                            '0%': {opacity: '0'},
                            '100%': {opacity: '1'},
                        },
                        pulseRing: {
                            '0%': {transform: 'scale(1)', opacity: '1'},
                            '100%': {transform: 'scale(1.3)', opacity: '0'},
                        },
                        growCircle: {
                            '0%': {transform: 'scale(1)'},
                            '100%': {transform: 'scale(1.1)'},
                        },
                    },
                    boxShadow: {
                        'pastel': '0 6px 12px rgba(180, 160, 150, 0.1)',
                        'pastel-lg': '0 10px 25px rgba(180, 160, 150, 0.15)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Blob animation styles */
        .blob-animation {
            animation: blob-move 15s infinite alternate;
        }

        @keyframes blob-move {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
            33% {
                transform: translate(30px, -50px) rotate(20deg) scale(1.1);
            }
            66% {
                transform: translate(-20px, 20px) rotate(-10deg) scale(0.9);
            }
            100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
        }

        /* Button hover effect */
        .btn-hover-effect:hover {
            box-shadow: 0 0 15px rgba(255, 140, 105, 0.5);
        }

        /* Custom scrollbar for pastel theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #fdf6f0;
        }

        ::-webkit-scrollbar-thumb {
            background: #ffb5a7;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #ff8c69;
        }

        /* Timer button styles */
        .timer-button {
            position: relative;
            overflow: hidden;
        }

        .timer-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 140, 105, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .timer-button.active::before {
            width: 120%;
            height: 120%;
        }

        .timer-button.active::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border: 2px solid rgba(255, 140, 105, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: pulse-ring 1.5s ease-out infinite;
        }

        /* Segmented control styles */
        .segmented-control {
            position: relative;
            background: #fdf6f0;
            border-radius: 24px;
            padding: 4px;
        }

        .segmented-control-indicator {
            position: absolute;
            top: 4px;
            left: 4px;
            height: calc(100% - 8px);
            background: #ff8c69;
            border-radius: 20px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .segmented-control input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .segmented-control label {
            position: relative;
            z-index: 1;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .segmented-control input[type="radio"]:checked + label {
            color: white;
        }

        /* Auto-expanding textarea */
        .auto-expand {
            resize: none;
            overflow: hidden;
            min-height: 80px;
        }

        /* Emoji button styles */
        .emoji-btn {
            transition: transform 0.2s ease;
        }

        .emoji-btn:hover {
            transform: scale(1.2);
        }

        /* Temperature indicator */
        .temp-indicator {
            transition: color 0.3s ease;
        }

        .temp-cold {
            color: #60a5fa;
        }

        .temp-perfect {
            color: #10b981;
        }

        .temp-warm {
            color: #f59e0b;
        }

        .temp-hot {
            color: #ef4444;
        }

        /* Baby selector dropdown */
        .baby-selector {
            position: relative;
        }

        .baby-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 4px;
            background: white;
            border: 1px solid #ffe8d9;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(180, 160, 150, 0.15);
            max-height: 200px;
            overflow-y: auto;
        }

        /* Recent feedings list */
        .feeding-history-item {
            transition: all 0.2s ease;
        }

        .feeding-history-item:hover {
            background-color: #fdf6f0;
            transform: translateX(4px);
        }
    </style>
</head>
<body class="h-full bg-pastel-lightest font-sans text-pastel-text">
<div class="flex h-full relative">
    <!-- Background Decorative Elements -->
    <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 right-[10%] w-64 h-64 rounded-full bg-pastel-accent1 opacity-20 blur-3xl blob-animation"></div>
        <div class="absolute bottom-40 left-[15%] w-80 h-80 rounded-full bg-pastel-accent2 opacity-20 blur-3xl blob-animation"
             style="animation-delay: 2s;"></div>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn"
            class="lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-full shadow-pastel-lg opacity-0 animate-fade-in"
            style="animation-delay: 0.1s; animation-fill-mode: forwards;">
        <i data-lucide="menu" class="h-5 w-5 text-pastel-primary"></i>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar"
           class="fixed lg:relative inset-y-0 left-0 z-40 w-64 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col gap-6 border-r border-pastel-light bg-white/80 backdrop-blur-lg p-6">
        <!-- Logo and Brand -->
        <div class="flex items-center space-x-2 opacity-0 animate-fade-in-right"
             style="animation-delay: 0.2s; animation-fill-mode: forwards;">
            <div class="w-10 h-10 rounded-full bg-pastel-primary flex items-center justify-center text-white font-serif font-semibold text-xl">
                <i data-lucide="baby" class="h-6 w-6"></i>
            </div>
            <span class="font-serif text-pastel-heading text-xl">BabyHelper</span>
        </div>

        <!-- Quick Action Button -->
        <button class="btn-hover-effect flex items-center justify-between gap-3 text-sm font-medium bg-pastel-primary text-white p-3 rounded-full shadow-pastel transition-all duration-300 hover:bg-pastel-primaryHover hover:transform hover:-translate-y-0.5 opacity-0 animate-fade-in-right"
                style="animation-delay: 0.3s; animation-fill-mode: forwards;">
                <span class="flex items-center gap-3">
                    <i data-lucide="plus" class="h-4 w-4"></i>
                    Add New Entry
                </span>
            <kbd class="text-xs text-white/80 hidden sm:block">⌘A</kbd>
        </button>

        <!-- Navigation -->
        <nav class="flex flex-col gap-2 text-sm opacity-0 animate-fade-in-right"
             style="animation-delay: 0.4s; animation-fill-mode: forwards;">
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="bar-chart-3" class="h-4 w-4"></i>
                Insights & Analysis
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="moon" class="h-4 w-4"></i>
                Sleep Tracking
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full bg-pastel-light text-pastel-primary font-medium">
                <i data-lucide="utensils" class="h-4 w-4"></i>
                <span class="flex-1">Feeding Log</span>
                <span class="ml-auto text-xs bg-pastel-accent1/20 text-pastel-primary px-2 py-0.5 rounded-full font-medium">NOW</span>
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="heart" class="h-4 w-4"></i>
                Health Records
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="calendar" class="h-4 w-4"></i>
                Development Milestones
            </a>
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-full hover:bg-pastel-light transition-colors text-pastel-text hover:text-pastel-primary">
                <i data-lucide="settings" class="h-4 w-4"></i>
                Settings
            </a>
        </nav>

        <!-- Recent Feedings Card -->
        <div id="recentFeedings"
             class="bg-white rounded-2xl border border-pastel-light p-4 opacity-0 animate-fade-in-up hidden"
             style="animation-delay: 0.45s; animation-fill-mode: forwards;">
            <h4 class="text-sm font-semibold text-pastel-heading mb-3">Recent Feedings</h4>
            <div id="recentFeedingsList" class="space-y-2 text-sm">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Premium Upgrade Card -->
        <div class="mt-auto bg-gradient-to-br from-pastel-primary/10 to-pastel-accent1/10 p-4 rounded-2xl border border-pastel-light opacity-0 animate-fade-in-up"
             style="animation-delay: 0.5s; animation-fill-mode: forwards;">
            <p class="text-sm leading-relaxed text-pastel-text">
                Upgrade to <span class="font-semibold text-pastel-primary">BabyHelper Pro</span> for advanced insights
                and personalized recommendations!
            </p>
            <div class="flex items-center justify-between mt-4 text-sm">
                <button class="hover:underline text-pastel-textLight">Maybe Later</button>
                <button class="bg-pastel-primary hover:bg-pastel-primaryHover text-white px-4 py-1.5 rounded-full font-medium transition-colors">
                    Go Premium
                </button>
            </div>
        </div>
    </aside>

    <!-- Overlay for mobile -->
    <div id="overlay" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-30 lg:hidden hidden"></div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden relative z-10">
        <!-- Feature A: Header with Context -->
        <header class="flex items-center justify-between gap-4 px-4 lg:px-6 py-4 border-b border-pastel-light bg-white/60 backdrop-blur-lg opacity-0 animate-fade-in"
                style="animation-delay: 0.2s; animation-fill-mode: forwards;">
            <div class="flex items-center gap-4">
                <div class="lg:hidden w-8"></div>
                <!-- Baby selector and name -->
                <div class="baby-selector">
                    <div class="flex items-center gap-3 cursor-pointer" id="babySelector">
                        <div class="h-12 w-12 rounded-full bg-gradient-to-br from-pastel-primary to-pastel-accent1 flex items-center justify-center text-white font-semibold overflow-hidden">
                            <span id="babyInitials">?</span>
                        </div>
                        <div>
                            <h1 class="text-base lg:text-lg font-serif font-medium text-pastel-heading">
                                <span id="babyName">Select Baby</span>'s Feeding
                                <i data-lucide="chevron-down" class="h-4 w-4 inline ml-1"></i>
                            </h1>
                            <p class="text-xs lg:text-sm text-pastel-textLight">
                                <span id="sessionStatus" class="inline-flex items-center gap-1">
                                    <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                                    Ready to start
                                </span>
                            </p>
                        </div>
                    </div>
                    <!-- Baby dropdown -->
                    <div id="babyDropdown" class="baby-dropdown hidden">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>
            <!-- Timer display -->
            <div class="flex items-center gap-3">
                <div id="mainTimer" class="text-2xl font-mono font-semibold text-pastel-heading hidden">
                    <span id="timerDisplay">00:00</span>
                </div>
                <button class="relative hidden sm:block p-2 hover:bg-pastel-light rounded-full transition-colors">
                    <i data-lucide="bell" class="h-5 w-5 text-pastel-text"></i>
                    <span class="absolute top-1 right-1 h-2 w-2 rounded-full bg-pastel-primary"></span>
                </button>
                <button class="hidden sm:block p-2 hover:bg-pastel-light rounded-full transition-colors">
                    <i data-lucide="help-circle" class="h-5 w-5 text-pastel-text"></i>
                </button>
                <div id="userAvatar"
                     class="h-9 w-9 rounded-full bg-gradient-to-br from-pastel-primary to-pastel-accent1 flex items-center justify-center text-sm font-medium text-white shadow-pastel">
                    ?
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <section class="flex-1 overflow-y-auto p-4 lg:p-6 space-y-6">
            <!-- Baby Selection Prompt -->
            <div id="babySelectionPrompt"
                 class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 flex items-start gap-3">
                <i data-lucide="alert-circle" class="h-5 w-5 text-yellow-600 mt-0.5"></i>
                <div class="flex-1">
                    <p class="text-sm font-medium text-yellow-800">Please select a baby first</p>
                    <p class="text-xs text-yellow-700 mt-1">Click on the baby selector above to choose which baby you're
                        tracking.</p>
                </div>
            </div>

            <!-- Feature B: Input Method Selector -->
            <div id="feedingMethodSelector"
                 class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up hidden"
                 style="animation-delay: 0.3s; animation-fill-mode: forwards;">
                <h2 class="text-xl font-serif font-medium text-pastel-heading mb-4">Select Feeding Method</h2>
                <div class="segmented-control relative h-12 flex items-center">
                    <div id="segmentIndicator" class="segmented-control-indicator"
                         style="width: calc(33.33% - 8px);"></div>
                    <div class="flex flex-1 gap-2">
                        <div class="flex-1">
                            <input type="radio" name="feedingMethod" id="breast" value="breast" checked>
                            <label for="breast"
                                   class="flex items-center justify-center h-10 w-full text-sm font-medium text-pastel-text">
                                <i data-lucide="baby" class="h-4 w-4 mr-2"></i>
                                Breast
                            </label>
                        </div>
                        <div class="flex-1">
                            <input type="radio" name="feedingMethod" id="bottle" value="bottle">
                            <label for="bottle"
                                   class="flex items-center justify-center h-10 w-full text-sm font-medium text-pastel-text">
                                <i data-lucide="milk" class="h-4 w-4 mr-2"></i>
                                Bottle
                            </label>
                        </div>
                        <div class="flex-1">
                            <input type="radio" name="feedingMethod" id="solids" value="solids">
                            <label for="solids"
                                   class="flex items-center justify-center h-10 w-full text-sm font-medium text-pastel-text">
                                <i data-lucide="apple" class="h-4 w-4 mr-2"></i>
                                Solids
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feature C: Breastfeeding Interface -->
            <div id="breastfeedingInterface"
                 class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up hidden"
                 style="animation-delay: 0.4s; animation-fill-mode: forwards;">
                <h3 class="text-lg font-serif font-medium text-pastel-heading mb-6">Breastfeeding Session</h3>

                <!-- Dual timer layout -->
                <div class="flex items-center justify-around gap-4 mb-6">
                    <!-- Left breast timer -->
                    <div class="text-center">
                        <p class="text-sm text-pastel-textLight mb-2">Left Breast</p>
                        <button id="leftBreastTimer"
                                class="timer-button w-24 h-24 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors flex flex-col items-center justify-center">
                            <i data-lucide="play" class="h-8 w-8 text-pastel-primary mb-1"></i>
                            <span class="text-xs font-mono font-semibold text-pastel-text">00:00</span>
                        </button>
                    </div>

                    <!-- Switch button -->
                    <button id="switchSide"
                            class="w-10 h-10 rounded-full bg-pastel-accent1 hover:bg-pastel-primary transition-colors flex items-center justify-center disabled:opacity-50"
                            disabled>
                        <i data-lucide="repeat" class="h-5 w-5 text-white"></i>
                    </button>

                    <!-- Right breast timer -->
                    <div class="text-center">
                        <p class="text-sm text-pastel-textLight mb-2">Right Breast</p>
                        <button id="rightBreastTimer"
                                class="timer-button w-24 h-24 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors flex flex-col items-center justify-center">
                            <i data-lucide="play" class="h-8 w-8 text-pastel-primary mb-1"></i>
                            <span class="text-xs font-mono font-semibold text-pastel-text">00:00</span>
                        </button>
                    </div>
                </div>

                <!-- Session notes -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Session Notes</label>
                    <textarea id="breastfeedingNotes"
                              class="auto-expand w-full px-4 py-3 rounded-xl border border-pastel-light focus:border-pastel-primary focus:outline-none transition-colors"
                              placeholder="Add notes about the feeding session..."></textarea>
                </div>

                <!-- Control buttons -->
                <div class="flex gap-3">
                    <button id="pauseBreastfeeding"
                            class="flex-1 px-4 py-3 rounded-full border border-pastel-primary text-pastel-primary hover:bg-pastel-light transition-colors font-medium disabled:opacity-50"
                            disabled>
                        <i data-lucide="pause" class="h-4 w-4 inline mr-2"></i>
                        Pause
                    </button>
                    <button id="completeBreastfeeding"
                            class="flex-1 px-4 py-3 rounded-full bg-pastel-primary text-white hover:bg-pastel-primaryHover transition-colors font-medium disabled:opacity-50"
                            disabled>
                        <i data-lucide="check" class="h-4 w-4 inline mr-2"></i>
                        Complete
                    </button>
                </div>
            </div>

            <!-- Feature D: Bottle Feeding Interface -->
            <div id="bottleInterface"
                 class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 hidden">
                <h3 class="text-lg font-serif font-medium text-pastel-heading mb-6">Bottle Feeding</h3>

                <!-- Amount input -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Amount (ml)</label>
                    <div class="flex items-center gap-4">
                        <button id="decreaseAmount"
                                class="w-12 h-12 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors flex items-center justify-center">
                            <i data-lucide="minus" class="h-5 w-5 text-pastel-primary"></i>
                        </button>
                        <input type="number" id="bottleAmount" value="120" step="10" min="0" max="350"
                               class="w-24 text-center text-2xl font-semibold text-pastel-heading border-b-2 border-pastel-light focus:border-pastel-primary outline-none">
                        <button id="increaseAmount"
                                class="w-12 h-12 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors flex items-center justify-center">
                            <i data-lucide="plus" class="h-5 w-5 text-pastel-primary"></i>
                        </button>
                    </div>
                </div>

                <!-- Fluid type -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Fluid Type</label>
                    <select id="bottleFluidType"
                            class="w-full px-4 py-3 rounded-xl border border-pastel-light focus:border-pastel-primary focus:outline-none transition-colors">
                        <option value="breast_milk">Breast Milk</option>
                        <option value="formula">Formula</option>
                        <option value="mixed">Mixed (Breast Milk + Formula)</option>
                    </select>
                </div>

                <!-- Temperature indicator -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Temperature</label>
                    <div class="flex gap-2">
                        <button data-temp="cold"
                                class="temp-indicator temp-cold flex-1 p-3 rounded-xl border border-pastel-light hover:border-current transition-colors flex flex-col items-center gap-1">
                            <i data-lucide="snowflake" class="h-5 w-5"></i>
                            <span class="text-xs">Cold</span>
                        </button>
                        <button data-temp="perfect"
                                class="temp-indicator temp-perfect flex-1 p-3 rounded-xl border-2 border-current transition-colors flex flex-col items-center gap-1">
                            <i data-lucide="thermometer" class="h-5 w-5"></i>
                            <span class="text-xs">Perfect</span>
                        </button>
                        <button data-temp="warm"
                                class="temp-indicator temp-warm flex-1 p-3 rounded-xl border border-pastel-light hover:border-current transition-colors flex flex-col items-center gap-1">
                            <i data-lucide="sun" class="h-5 w-5"></i>
                            <span class="text-xs">Warm</span>
                        </button>
                        <button data-temp="hot"
                                class="temp-indicator temp-hot flex-1 p-3 rounded-xl border border-pastel-light hover:border-current transition-colors flex flex-col items-center gap-1">
                            <i data-lucide="flame" class="h-5 w-5"></i>
                            <span class="text-xs">Hot</span>
                        </button>
                    </div>
                </div>

                <!-- Notes -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Notes</label>
                    <textarea id="bottleNotes"
                              class="w-full px-4 py-3 rounded-xl border border-pastel-light focus:border-pastel-primary focus:outline-none transition-colors"
                              rows="2" placeholder="Any notes about the feeding..."></textarea>
                </div>

                <!-- Optional timer -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Duration Timer (Optional)</label>
                    <button id="bottleTimer"
                            class="timer-button w-16 h-16 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors flex flex-col items-center justify-center">
                        <i data-lucide="play" class="h-6 w-6 text-pastel-primary"></i>
                        <span class="text-xs font-mono font-semibold text-pastel-text hidden">00:00</span>
                    </button>
                </div>
            </div>

            <!-- Feature E: Solids Interface -->
            <div id="solidsInterface"
                 class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 hidden">
                <h3 class="text-lg font-serif font-medium text-pastel-heading mb-6">Solid Foods</h3>

                <!-- Food item selector -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Food Item</label>
                    <div class="relative">
                        <input id="solidsFoodItem" type="text" placeholder="Search or select food..."
                               class="w-full px-4 py-3 pr-10 rounded-xl border border-pastel-light focus:border-pastel-primary focus:outline-none transition-colors">
                        <i data-lucide="search" class="absolute right-3 top-3.5 h-5 w-5 text-pastel-textLight"></i>
                    </div>
                    <!-- Recent items -->
                    <div class="mt-2 flex flex-wrap gap-2">
                        <button data-food="Banana"
                                class="food-preset px-3 py-1.5 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors text-sm">
                            Banana
                        </button>
                        <button data-food="Avocado"
                                class="food-preset px-3 py-1.5 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors text-sm">
                            Avocado
                        </button>
                        <button data-food="Sweet Potato"
                                class="food-preset px-3 py-1.5 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors text-sm">
                            Sweet Potato
                        </button>
                        <button data-food="Oatmeal"
                                class="food-preset px-3 py-1.5 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors text-sm">
                            Oatmeal
                        </button>
                    </div>
                </div>

                <!-- Amount estimation -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Portion Size (grams)</label>
                    <div class="flex items-center gap-4">
                        <button id="decreaseSolidsAmount"
                                class="w-12 h-12 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors flex items-center justify-center">
                            <i data-lucide="minus" class="h-5 w-5 text-pastel-primary"></i>
                        </button>
                        <input type="number" id="solidsAmount" value="50" step="10" min="0" max="500"
                               class="w-24 text-center text-2xl font-semibold text-pastel-heading border-b-2 border-pastel-light focus:border-pastel-primary outline-none">
                        <button id="increaseSolidsAmount"
                                class="w-12 h-12 rounded-full bg-pastel-light hover:bg-pastel-secondary transition-colors flex items-center justify-center">
                            <i data-lucide="plus" class="h-5 w-5 text-pastel-primary"></i>
                        </button>
                    </div>
                </div>

                <!-- Texture selector -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Texture</label>
                    <select id="solidsTexture"
                            class="w-full px-4 py-3 rounded-xl border border-pastel-light focus:border-pastel-primary focus:outline-none transition-colors">
                        <option>Puree</option>
                        <option>Mashed</option>
                        <option>Chunky</option>
                        <option>Finger Food</option>
                        <option>Regular</option>
                    </select>
                </div>

                <!-- Reaction notes with emoji -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-pastel-text mb-2">Baby's Reaction</label>
                    <div class="flex gap-2 mb-2">
                        <button data-reaction="loved" class="emoji-btn text-2xl">😍</button>
                        <button data-reaction="liked" class="emoji-btn text-2xl">😊</button>
                        <button data-reaction="neutral" class="emoji-btn text-2xl">😐</button>
                        <button data-reaction="unsure" class="emoji-btn text-2xl">🤔</button>
                        <button data-reaction="disliked" class="emoji-btn text-2xl">😣</button>
                        <button data-reaction="rejected" class="emoji-btn text-2xl">🤮</button>
                    </div>
                    <textarea id="solidsNotes"
                              class="w-full px-4 py-3 rounded-xl border border-pastel-light focus:border-pastel-primary focus:outline-none transition-colors"
                              rows="2" placeholder="How did it go?"></textarea>
                </div>
            </div>

            <!-- Feature F: Quick Notes Section -->
            <div id="quickNotesSection"
                 class="bg-white rounded-2xl shadow-pastel-lg border border-pastel-light p-6 opacity-0 animate-fade-in-up hidden"
                 style="animation-delay: 0.5s; animation-fill-mode: forwards;">
                <h3 class="text-lg font-serif font-medium text-pastel-heading mb-4">Quick Notes</h3>

                <!-- Pre-defined tags -->
                <div class="flex flex-wrap gap-2 mb-4">
                    <button data-tag="Fussy"
                            class="tag-btn px-4 py-2 rounded-full border border-pastel-light hover:border-pastel-primary hover:bg-pastel-light transition-colors text-sm">
                        😤 Fussy
                    </button>
                    <button data-tag="Content"
                            class="tag-btn px-4 py-2 rounded-full border border-pastel-light hover:border-pastel-primary hover:bg-pastel-light transition-colors text-sm">
                        😌 Content
                    </button>
                    <button data-tag="Sleepy"
                            class="tag-btn px-4 py-2 rounded-full border border-pastel-light hover:border-pastel-primary hover:bg-pastel-light transition-colors text-sm">
                        😴 Sleepy
                    </button>
                    <button data-tag="Congested"
                            class="tag-btn px-4 py-2 rounded-full border border-pastel-light hover:border-pastel-primary hover:bg-pastel-light transition-colors text-sm">
                        🤧 Congested
                    </button>
                    <button data-tag="Happy"
                            class="tag-btn px-4 py-2 rounded-full border border-pastel-light hover:border-pastel-primary hover:bg-pastel-light transition-colors text-sm">
                        😊 Happy
                    </button>
                    <button data-tag="Good Latch"
                            class="tag-btn px-4 py-2 rounded-full border border-pastel-light hover:border-pastel-primary hover:bg-pastel-light transition-colors text-sm">
                        🎯 Good Latch
                    </button>
                </div>

                <!-- Custom note area -->
                <textarea id="customNotes"
                          class="auto-expand w-full px-4 py-3 rounded-xl border border-pastel-light focus:border-pastel-primary focus:outline-none transition-colors mb-3"
                          placeholder="Add any additional notes..."></textarea>

                <!-- Photo attachment -->
                <button class="flex items-center gap-2 text-sm text-pastel-primary hover:text-pastel-primaryHover transition-colors">
                    <i data-lucide="camera" class="h-4 w-4"></i>
                    Attach Photo
                </button>
            </div>

            <!-- Feature G: Session Summary -->
            <div id="sessionSummary"
                 class="bg-gradient-to-br from-pastel-primary/10 to-pastel-accent1/10 rounded-2xl border border-pastel-light p-6 opacity-0 animate-fade-in-up hidden"
                 style="animation-delay: 0.6s; animation-fill-mode: forwards;">
                <h3 class="text-lg font-serif font-medium text-pastel-heading mb-4">Session Summary</h3>

                <div class="space-y-3 mb-6">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-pastel-text">Duration</span>
                        <span id="summaryDuration" class="font-semibold text-pastel-heading">--:--</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-pastel-text">Method</span>
                        <span id="summaryMethod" class="font-semibold text-pastel-heading">Breastfeeding</span>
                    </div>
                    <div id="summaryDetails" class="text-sm text-pastel-textLight">
                        <!-- Dynamic content based on feeding method -->
                    </div>
                    <div id="summaryNotes" class="text-sm text-pastel-text italic hidden">
                        <!-- Notes preview -->
                    </div>
                </div>

                <!-- Save buttons -->
                <button id="saveSession"
                        class="w-full h-14 bg-pastel-primary hover:bg-pastel-primaryHover text-white rounded-full font-medium transition-colors mb-3 btn-hover-effect">
                    Save Feeding Session
                </button>
                <button id="saveAndNext"
                        class="w-full text-sm text-pastel-primary hover:text-pastel-primaryHover transition-colors">
                    Save & Start Next Feeding
                </button>
            </div>

            <!-- Feature H: Error/Warning Messages (hidden by default) -->
            <div id="warningMessage"
                 class="hidden bg-yellow-50 border border-yellow-200 rounded-xl p-4 flex items-start gap-3">
                <i data-lucide="alert-triangle" class="h-5 w-5 text-yellow-600 mt-0.5"></i>
                <div class="flex-1">
                    <p class="text-sm font-medium text-yellow-800">Long feeding session detected</p>
                    <p class="text-xs text-yellow-700 mt-1">This feeding has exceeded 45 minutes. Is everything
                        okay?</p>
                </div>
            </div>

            <!-- Success Message -->
            <div id="successMessage"
                 class="hidden bg-green-50 border border-green-200 rounded-xl p-4 flex items-start gap-3">
                <i data-lucide="check-circle" class="h-5 w-5 text-green-600 mt-0.5"></i>
                <div class="flex-1">
                    <p class="text-sm font-medium text-green-800">Feeding session saved successfully!</p>
                    <p class="text-xs text-green-700 mt-1">The feeding has been recorded.</p>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage"
                 class="hidden bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3">
                <i data-lucide="x-circle" class="h-5 w-5 text-red-600 mt-0.5"></i>
                <div class="flex-1">
                    <p class="text-sm font-medium text-red-800">Error saving feeding session</p>
                    <p id="errorMessageText" class="text-xs text-red-700 mt-1">Please try again.</p>
                </div>
            </div>

            <!-- Decorative floating elements -->
            <div class="fixed bottom-20 right-10 w-32 h-32 rounded-full bg-pastel-accent1 opacity-10 animate-float pointer-events-none"></div>
            <div class="fixed top-40 right-1/4 w-24 h-24 rounded-full bg-pastel-accent2 opacity-10 animate-float-delayed pointer-events-none"></div>
        </section>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="lg:hidden border-t border-pastel-light bg-white/80 backdrop-blur-lg">
            <div class="grid grid-cols-4 gap-1">
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="home" class="h-5 w-5"></i>
                    <span class="text-xs">Home</span>
                </button>
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="bar-chart-3" class="h-5 w-5"></i>
                    <span class="text-xs">Insights</span>
                </button>
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-primary">
                    <i data-lucide="plus-circle" class="h-5 w-5"></i>
                    <span class="text-xs">Add</span>
                </button>
                <button class="flex flex-col items-center gap-1 py-3 text-pastel-textLight hover:text-pastel-primary transition-colors">
                    <i data-lucide="user" class="h-5 w-5"></i>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
        </nav>
    </div>
</div>

<script src="../js/auth.js" data-auto-init="true"></script>
<script>
    // Global state management
    const FeedingTracker = {
        selectedBaby: null,
        sessionStartTime: null,
        currentFeedingMethod: 'breast',
        selectedTags: new Set(),
        selectedReaction: null,
        selectedTemperature: 'perfect',
        sessionData: {
            breast: {
                leftDuration: 0,
                rightDuration: 0,
                notes: ''
            },
            bottle: {
                amount: 120,
                fluidType: 'breast_milk',
                temperature: 'perfect',
                duration: 0,
                notes: ''
            },
            solids: {
                foodItem: '',
                amount: 50,
                texture: 'Puree',
                reaction: null,
                notes: ''
            }
        }
    };

    document.addEventListener('DOMContentLoaded', async () => {
        // Initialize Lucide icons
        lucide.createIcons();

        // Initialize user data and babies
        await initializeUserData();
        await loadBabies();

        // Mobile menu toggle functionality
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        function toggleMobileMenu() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        overlay.addEventListener('click', toggleMobileMenu);

        // Baby selector functionality
        const babySelector = document.getElementById('babySelector');
        const babyDropdown = document.getElementById('babyDropdown');

        babySelector.addEventListener('click', () => {
            babyDropdown.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!babySelector.contains(e.target) && !babyDropdown.contains(e.target)) {
                babyDropdown.classList.add('hidden');
            }
        });

        // Feeding method selector
        const feedingMethods = document.querySelectorAll('input[name="feedingMethod"]');
        const segmentIndicator = document.getElementById('segmentIndicator');
        const interfaces = {
            breast: document.getElementById('breastfeedingInterface'),
            bottle: document.getElementById('bottleInterface'),
            solids: document.getElementById('solidsInterface')
        };

        feedingMethods.forEach((method, index) => {
            method.addEventListener('change', (e) => {
                // Update indicator position
                segmentIndicator.style.transform = `translateX(${index * 100}%)`;

                // Update current feeding method
                FeedingTracker.currentFeedingMethod = e.target.value;

                // Show/hide interfaces
                Object.keys(interfaces).forEach(key => {
                    interfaces[key].classList.toggle('hidden', key !== e.target.value);
                });

                // Update summary
                document.getElementById('summaryMethod').textContent =
                    e.target.value.charAt(0).toUpperCase() + e.target.value.slice(1) + ' Feeding';
            });
        });

        // Timer functionality
        let timers = {
            main: {interval: null, seconds: 0},
            leftBreast: {interval: null, seconds: 0},
            rightBreast: {interval: null, seconds: 0},
            bottle: {interval: null, seconds: 0}
        };

        let activeBreastSide = null;
        let sessionActive = false;

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimer(timerName, displayElement) {
            timers[timerName].seconds++;
            if (displayElement) {
                displayElement.textContent = formatTime(timers[timerName].seconds);
            }

            // Update session data
            if (timerName === 'leftBreast') {
                FeedingTracker.sessionData.breast.leftDuration = timers[timerName].seconds;
            } else if (timerName === 'rightBreast') {
                FeedingTracker.sessionData.breast.rightDuration = timers[timerName].seconds;
            } else if (timerName === 'bottle') {
                FeedingTracker.sessionData.bottle.duration = timers[timerName].seconds;
            }

            // Warning for long sessions
            if (timerName === 'main' && timers.main.seconds === 2700) { // 45 minutes
                document.getElementById('warningMessage').classList.remove('hidden');
            }
        }

        function startTimer(timerName, displayElement, buttonElement) {
            if (!timers[timerName].interval) {
                timers[timerName].interval = setInterval(() => {
                    updateTimer(timerName, displayElement);
                }, 1000);

                if (buttonElement) {
                    buttonElement.classList.add('active');
                    const icon = buttonElement.querySelector('i');
                    if (icon) {
                        icon.setAttribute('data-lucide', 'pause');
                        lucide.createIcons();
                    }
                }
            }
        }

        function stopTimer(timerName, buttonElement) {
            if (timers[timerName].interval) {
                clearInterval(timers[timerName].interval);
                timers[timerName].interval = null;

                if (buttonElement) {
                    buttonElement.classList.remove('active');
                    const icon = buttonElement.querySelector('i');
                    if (icon) {
                        icon.setAttribute('data-lucide', 'play');
                        lucide.createIcons();
                    }
                }
            }
        }

        // Breastfeeding timers
        const leftBreastBtn = document.getElementById('leftBreastTimer');
        const rightBreastBtn = document.getElementById('rightBreastTimer');
        const switchBtn = document.getElementById('switchSide');
        const pauseBtn = document.getElementById('pauseBreastfeeding');
        const completeBtn = document.getElementById('completeBreastfeeding');

        function handleBreastTimer(side) {
            const btn = side === 'left' ? leftBreastBtn : rightBreastBtn;
            const timerSpan = btn.querySelector('span');
            const timerName = side === 'left' ? 'leftBreast' : 'rightBreast';

            if (!sessionActive) {
                // Start session
                sessionActive = true;
                activeBreastSide = side;
                FeedingTracker.sessionStartTime = new Date();
                startTimer('main', document.getElementById('timerDisplay'));
                startTimer(timerName, timerSpan, btn);
                document.getElementById('mainTimer').classList.remove('hidden');
                document.getElementById('sessionStatus').innerHTML = '<span class="w-2 h-2 bg-pastel-primary rounded-full animate-pulse"></span> Session Active';
                pauseBtn.disabled = false;
                completeBtn.disabled = false;
                switchBtn.disabled = false;
            } else if (activeBreastSide === side) {
                // Pause current side
                stopTimer(timerName, btn);
                activeBreastSide = null;
                switchBtn.disabled = true;
            } else {
                // Switch sides
                const otherSide = side === 'left' ? 'right' : 'left';
                const otherBtn = side === 'left' ? rightBreastBtn : leftBreastBtn;
                const otherTimerName = side === 'left' ? 'rightBreast' : 'leftBreast';

                stopTimer(otherTimerName, otherBtn);
                startTimer(timerName, timerSpan, btn);
                activeBreastSide = side;
            }
        }

        leftBreastBtn.addEventListener('click', () => handleBreastTimer('left'));
        rightBreastBtn.addEventListener('click', () => handleBreastTimer('right'));

        switchBtn.addEventListener('click', () => {
            if (activeBreastSide) {
                const newSide = activeBreastSide === 'left' ? 'right' : 'left';
                handleBreastTimer(newSide);
            }
        });

        pauseBtn.addEventListener('click', () => {
            if (sessionActive) {
                stopTimer('main');
                stopTimer('leftBreast', leftBreastBtn);
                stopTimer('rightBreast', rightBreastBtn);
                activeBreastSide = null;
                switchBtn.disabled = true;
                pauseBtn.textContent = 'Resume';
                pauseBtn.innerHTML = '<i data-lucide="play" class="h-4 w-4 inline mr-2"></i>Resume';
                lucide.createIcons();
            }
        });

        completeBtn.addEventListener('click', () => {
            stopTimer('main');
            stopTimer('leftBreast', leftBreastBtn);
            stopTimer('rightBreast', rightBreastBtn);

            // Update summary
            const totalSeconds = timers.main.seconds;
            document.getElementById('summaryDuration').textContent = formatTime(totalSeconds);
            const leftTime = formatTime(timers.leftBreast.seconds);
            const rightTime = formatTime(timers.rightBreast.seconds);
            document.getElementById('summaryDetails').innerHTML = `
                <div class="flex justify-between">
                    <span>Left: ${leftTime}</span>
                    <span>Right: ${rightTime}</span>
                </div>
            `;

            // Update notes
            FeedingTracker.sessionData.breast.notes = document.getElementById('breastfeedingNotes').value;

            // Reset for next session
            sessionActive = false;
            activeBreastSide = null;
            pauseBtn.disabled = true;
            completeBtn.disabled = true;
            switchBtn.disabled = true;
            document.getElementById('sessionStatus').innerHTML = 'Ready to start';
        });

        // Bottle feeding controls
        const bottleAmount = document.getElementById('bottleAmount');
        const decreaseBtn = document.getElementById('decreaseAmount');
        const increaseBtn = document.getElementById('increaseAmount');

        decreaseBtn.addEventListener('click', () => {
            const current = parseInt(bottleAmount.value);
            if (current > 0) {
                bottleAmount.value = current - 10;
                FeedingTracker.sessionData.bottle.amount = current - 10;
            }
        });

        increaseBtn.addEventListener('click', () => {
            const current = parseInt(bottleAmount.value);
            if (current < 350) {
                bottleAmount.value = current + 10;
                FeedingTracker.sessionData.bottle.amount = current + 10;
            }
        });

        bottleAmount.addEventListener('change', (e) => {
            FeedingTracker.sessionData.bottle.amount = parseInt(e.target.value);
        });

        // Bottle fluid type
        document.getElementById('bottleFluidType').addEventListener('change', (e) => {
            FeedingTracker.sessionData.bottle.fluidType = e.target.value;
        });

        // Bottle notes
        document.getElementById('bottleNotes').addEventListener('input', (e) => {
            FeedingTracker.sessionData.bottle.notes = e.target.value;
        });

        // Temperature selector
        document.querySelectorAll('.temp-indicator').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.temp-indicator').forEach(b => {
                    b.classList.remove('border-2');
                    b.classList.add('border');
                });
                btn.classList.remove('border');
                btn.classList.add('border-2');
                FeedingTracker.sessionData.bottle.temperature = btn.dataset.temp;
            });
        });

        // Solids controls
        const solidsAmount = document.getElementById('solidsAmount');
        const decreaseSolidsBtn = document.getElementById('decreaseSolidsAmount');
        const increaseSolidsBtn = document.getElementById('increaseSolidsAmount');

        decreaseSolidsBtn.addEventListener('click', () => {
            const current = parseInt(solidsAmount.value);
            if (current > 0) {
                solidsAmount.value = current - 10;
                FeedingTracker.sessionData.solids.amount = current - 10;
            }
        });

        increaseSolidsBtn.addEventListener('click', () => {
            const current = parseInt(solidsAmount.value);
            if (current < 500) {
                solidsAmount.value = current + 10;
                FeedingTracker.sessionData.solids.amount = current + 10;
            }
        });

        solidsAmount.addEventListener('change', (e) => {
            FeedingTracker.sessionData.solids.amount = parseInt(e.target.value);
        });

        // Food presets
        document.querySelectorAll('.food-preset').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('solidsFoodItem').value = btn.dataset.food;
                FeedingTracker.sessionData.solids.foodItem = btn.dataset.food;
            });
        });

        document.getElementById('solidsFoodItem').addEventListener('input', (e) => {
            FeedingTracker.sessionData.solids.foodItem = e.target.value;
        });

        document.getElementById('solidsTexture').addEventListener('change', (e) => {
            FeedingTracker.sessionData.solids.texture = e.target.value;
        });

        document.getElementById('solidsNotes').addEventListener('input', (e) => {
            FeedingTracker.sessionData.solids.notes = e.target.value;
        });

        // Auto-expanding textareas
        document.querySelectorAll('.auto-expand').forEach(textarea => {
            textarea.addEventListener('input', function () {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
        });

        // Quick note tags
        document.querySelectorAll('.tag-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.classList.toggle('bg-pastel-primary');
                btn.classList.toggle('text-white');
                btn.classList.toggle('border-pastel-primary');

                const tag = btn.dataset.tag;
                if (FeedingTracker.selectedTags.has(tag)) {
                    FeedingTracker.selectedTags.delete(tag);
                } else {
                    FeedingTracker.selectedTags.add(tag);
                }
            });
        });

        // Emoji reactions
        document.querySelectorAll('.emoji-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('ring-2', 'ring-pastel-primary'));
                btn.classList.add('ring-2', 'ring-pastel-primary');
                FeedingTracker.sessionData.solids.reaction = btn.dataset.reaction;
            });
        });

        // Save session
        document.getElementById('saveSession').addEventListener('click', async () => {
            await saveFeeding();
        });

        document.getElementById('saveAndNext').addEventListener('click', async () => {
            await saveFeeding();
            // Reset form for next feeding
            resetForm();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Cmd/Ctrl + A to add new entry
            if ((e.metaKey || e.ctrlKey) && e.key === 'a') {
                e.preventDefault();
                console.log('Add new entry shortcut triggered');
            }
        });
    });

    // Initialize user data
    async function initializeUserData() {
        try {
            const userProfile = await BabyHelperAuth.api.endpoints.getUserProfile();
            if (userProfile) {
                // Update user avatar
                const userAvatar = document.getElementById('userAvatar');
                if (userProfile.name) {
                    const initials = userProfile.name.split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                    userAvatar.textContent = initials;
                }
            }
        } catch (error) {
            console.error('Failed to load user profile:', error);
        }
    }

    // Load babies for the current user
    async function loadBabies() {
        try {
            const babies = await BabyHelperAuth.api.endpoints.getBabies();
            const babyDropdown = document.getElementById('babyDropdown');
            babyDropdown.innerHTML = '';

            if (babies && babies.length > 0) {
                babies.forEach((baby, index) => {
                    const babyOption = document.createElement('div');
                    babyOption.className = 'px-4 py-3 hover:bg-pastel-light cursor-pointer flex items-center gap-3';
                    babyOption.innerHTML = `
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pastel-primary to-pastel-accent1 flex items-center justify-center text-white font-semibold text-sm">
                            ${baby.name ? baby.name.charAt(0).toUpperCase() : '?'}
                        </div>
                        <div>
                            <div class="font-medium text-pastel-heading">${baby.fullname}</div>
                            <div class="text-xs text-pastel-textLight">${calculateAge(baby.birthdate)}</div>
                        </div>
                    `;
                    babyOption.addEventListener('click', () => selectBaby(baby));
                    babyDropdown.appendChild(babyOption);

                    // Auto-select first baby
                    if (index === 0) {
                        selectBaby(baby);
                    }
                });

                // Show feeding interface elements
                document.getElementById('babySelectionPrompt').classList.add('hidden');
                document.getElementById('feedingMethodSelector').classList.remove('hidden');
                document.getElementById('breastfeedingInterface').classList.remove('hidden');
                document.getElementById('quickNotesSection').classList.remove('hidden');
                document.getElementById('sessionSummary').classList.remove('hidden');

                // Load recent feedings for selected baby
                if (FeedingTracker.selectedBaby) {
                    await loadRecentFeedings(FeedingTracker.selectedBaby.id);
                }
            } else {
                // No babies found
                document.getElementById('babyName').textContent = 'No babies found';
                document.getElementById('babySelectionPrompt').innerHTML = `
                    <i data-lucide="alert-circle" class="h-5 w-5 text-yellow-600 mt-0.5"></i>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-yellow-800">No babies found</p>
                        <p class="text-xs text-yellow-700 mt-1">Please add a baby first before tracking feedings.</p>
                    </div>
                `;
                lucide.createIcons();
            }
        } catch (error) {
            console.error('Failed to load babies:', error);
            showError('Failed to load babies. Please refresh the page.');
        }
    }

    // Select a baby
    function selectBaby(baby) {
        FeedingTracker.selectedBaby = baby;
        document.getElementById('babyName').textContent = baby.name;
        document.getElementById('babyInitials').textContent = baby.name ? baby.name.charAt(0).toUpperCase() : '?';
        document.getElementById('babyDropdown').classList.add('hidden');

        // Load recent feedings for this baby
        loadRecentFeedings(baby.id);
    }

    // Calculate age from date of birth
    function calculateAge(dateOfBirth) {
        const birthDate = new Date(dateOfBirth);
        const today = new Date();
        const diffTime = Math.abs(today - birthDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays < 30) {
            return `${diffDays} days old`;
        } else if (diffDays < 365) {
            const months = Math.floor(diffDays / 30);
            return `${months} month${months > 1 ? 's' : ''} old`;
        } else {
            const years = Math.floor(diffDays / 365);
            return `${years} year${years > 1 ? 's' : ''} old`;
        }
    }

    // Load recent feedings for a baby
    async function loadRecentFeedings(babyId) {
        try {
            const response = await BabyHelperAuth.api.request(`/feeding/baby/${babyId}?limit=5`);
            if (response.ok) {
                const feedings = await response.json();
                displayRecentFeedings(feedings);
            }
        } catch (error) {
            console.error('Failed to load recent feedings:', error);
        }
    }

    // Display recent feedings
    function displayRecentFeedings(feedings) {
        const recentFeedingsCard = document.getElementById('recentFeedings');
        const recentFeedingsList = document.getElementById('recentFeedingsList');

        if (feedings && feedings.length > 0) {
            recentFeedingsCard.classList.remove('hidden');
            recentFeedingsList.innerHTML = '';

            feedings.forEach(feeding => {
                const feedingItem = document.createElement('div');
                feedingItem.className = 'feeding-history-item p-2 rounded-lg cursor-pointer';

                const startTime = new Date(feeding.start_time);
                const timeAgo = getTimeAgo(startTime);
                const feedingType = getFeedingTypeDisplay(feeding.feeding_type);

                feedingItem.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-pastel-heading">${feedingType}</div>
                            <div class="text-xs text-pastel-textLight">${timeAgo}</div>
                        </div>
                        <div class="text-right">
                            ${feeding.amount ? `<div class="text-sm font-semibold">${feeding.amount}${feeding.feeding_type === 'solids' ? 'g' : 'ml'}</div>` : ''}
                            ${feeding.duration ? `<div class="text-xs text-pastel-textLight">${Math.floor(feeding.duration / 60)}m</div>` : ''}
                        </div>
                    </div>
                `;

                recentFeedingsList.appendChild(feedingItem);
            });
        } else {
            recentFeedingsCard.classList.add('hidden');
        }
    }

    // Get feeding type display name
    function getFeedingTypeDisplay(type) {
        const typeMap = {
            'breast_left': 'Breastfeeding (Left)',
            'breast_right': 'Breastfeeding (Right)',
            'breast_both': 'Breastfeeding',
            'bottle': 'Bottle',
            'formula': 'Formula',
            'solids': 'Solids',
            'pumping': 'Pumping'
        };
        return typeMap[type] || type;
    }

    // Get time ago string
    function getTimeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);

        let interval = seconds / 31536000;
        if (interval > 1) return Math.floor(interval) + " years ago";

        interval = seconds / 2592000;
        if (interval > 1) return Math.floor(interval) + " months ago";

        interval = seconds / 86400;
        if (interval > 1) return Math.floor(interval) + " days ago";

        interval = seconds / 3600;
        if (interval > 1) return Math.floor(interval) + " hours ago";

        interval = seconds / 60;
        if (interval > 1) return Math.floor(interval) + " minutes ago";

        return "Just now";
    }

    // Save feeding session
    async function saveFeeding() {
        if (!FeedingTracker.selectedBaby) {
            showError('Please select a baby first');
            return;
        }

        // Hide any existing messages
        document.getElementById('successMessage').classList.add('hidden');
        document.getElementById('errorMessage').classList.add('hidden');

        // Prepare feeding data based on method
        let feedingData = {
            baby_id: FeedingTracker.selectedBaby.id,
            start_time: FeedingTracker.sessionStartTime || new Date().toISOString()
        };

        // Collect all notes
        const allNotes = [];
        if (FeedingTracker.selectedTags.size > 0) {
            allNotes.push(`Tags: ${Array.from(FeedingTracker.selectedTags).join(', ')}`);
        }
        const customNotes = document.getElementById('customNotes').value;
        if (customNotes) {
            allNotes.push(customNotes);
        }

        if (FeedingTracker.currentFeedingMethod === 'breast') {
            const leftDuration = FeedingTracker.sessionData.breast.leftDuration;
            const rightDuration = FeedingTracker.sessionData.breast.rightDuration;

            if (leftDuration > 0 && rightDuration > 0) {
                feedingData.feeding_type = 'breast_both';
                feedingData.duration = leftDuration + rightDuration;
                feedingData.notes = `Left: ${Math.floor(leftDuration / 60)}m, Right: ${Math.floor(rightDuration / 60)}m`;
            } else if (leftDuration > 0) {
                feedingData.feeding_type = 'breast_left';
                feedingData.duration = leftDuration;
            } else if (rightDuration > 0) {
                feedingData.feeding_type = 'breast_right';
                feedingData.duration = rightDuration;
            } else {
                showError('Please start a feeding timer first');
                return;
            }

            if (FeedingTracker.sessionData.breast.notes) {
                allNotes.push(FeedingTracker.sessionData.breast.notes);
            }

            // Calculate end time
            const totalDuration = feedingData.duration;
            feedingData.end_time = new Date(new Date(feedingData.start_time).getTime() + totalDuration * 1000).toISOString();

        } else if (FeedingTracker.currentFeedingMethod === 'bottle') {
            feedingData.feeding_type = 'bottle';
            feedingData.amount = FeedingTracker.sessionData.bottle.amount;
            feedingData.bottle_content_type = FeedingTracker.sessionData.bottle.fluidType;

            if (FeedingTracker.sessionData.bottle.duration > 0) {
                feedingData.duration = FeedingTracker.sessionData.bottle.duration;
                feedingData.end_time = new Date(new Date(feedingData.start_time).getTime() + feedingData.duration * 1000).toISOString();
            }

            const tempNotes = [`Temperature: ${FeedingTracker.sessionData.bottle.temperature}`];
            if (FeedingTracker.sessionData.bottle.notes) {
                tempNotes.push(FeedingTracker.sessionData.bottle.notes);
            }
            allNotes.push(...tempNotes);

        } else if (FeedingTracker.currentFeedingMethod === 'solids') {
            if (!FeedingTracker.sessionData.solids.foodItem) {
                showError('Please enter a food item');
                return;
            }

            feedingData.feeding_type = 'solids';
            feedingData.amount = FeedingTracker.sessionData.solids.amount;

            const solidsNotes = [
                `Food: ${FeedingTracker.sessionData.solids.foodItem}`,
                `Texture: ${FeedingTracker.sessionData.solids.texture}`
            ];

            if (FeedingTracker.sessionData.solids.reaction) {
                solidsNotes.push(`Reaction: ${FeedingTracker.sessionData.solids.reaction}`);
            }

            if (FeedingTracker.sessionData.solids.notes) {
                solidsNotes.push(FeedingTracker.sessionData.solids.notes);
            }

            allNotes.push(...solidsNotes);
        }

        // Combine all notes
        if (allNotes.length > 0) {
            feedingData.notes = allNotes.join('\n');
        }

        try {
            const response = await BabyHelperAuth.api.request('/feeding/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(feedingData)
            });

            if (response.ok) {
                const savedFeeding = await response.json();
                showSuccess();

                // Reload recent feedings
                await loadRecentFeedings(FeedingTracker.selectedBaby.id);

                // Auto-hide success message after 3 seconds
                setTimeout(() => {
                    document.getElementById('successMessage').classList.add('hidden');
                }, 3000);
            } else {
                const error = await BabyHelperAuth.api.parseErrorResponse(response);
                showError(error.message || 'Failed to save feeding session');
            }
        } catch (error) {
            console.error('Failed to save feeding:', error);
            showError('Failed to save feeding session. Please try again.');
        }
    }

    // Show success message
    function showSuccess() {
        document.getElementById('successMessage').classList.remove('hidden');
        document.getElementById('errorMessage').classList.add('hidden');
    }

    // Show error message
    function showError(message) {
        document.getElementById('errorMessage').classList.remove('hidden');
        document.getElementById('errorMessageText').textContent = message;
        document.getElementById('successMessage').classList.add('hidden');

        // Auto-hide after 5 seconds
        setTimeout(() => {
            document.getElementById('errorMessage').classList.add('hidden');
        }, 5000);
    }

    // Reset form
    function resetForm() {
        // Reset timers
        location.reload(); // Simple reset for now
        // In a production app, you would reset all form fields and timers programmatically
    }
</script>
</body>
</html>